import psycopg2
import numpy as np

def do():
    conn = psycopg2.connect(database='asos', host='iemdb', user='nobody')
    cursor = conn.cursor()
    
    cursor.execute("""
     SELECT substr(date,5,4) as day, max(least) from 
     (SELECT substr(tm,1,8) as date, least(lag, lead, min) from
     (SELECT tm, lag(min) OVER (ORDER by tm ASC),
     lead(min) OVER (ORDER by tm ASC), min from
     (SELECT to_char(valid, 'YYYYMMDDHH24') as tm, min(sknt) from alldata
     WHERE station = 'DSM' and sknt >= 0 GROUP by tm) as foo
     ) as foo2
     ) as foo3 GROUP by day ORDER by day ASC
    """)
    
    wind = []
    for row in cursor:
        print row
        wind.append( row[1] )

    return wind

wind = [27.936, 34.920000000000002, 24.443999999999999, 27.936, 26.0, 24.0, 24.0, 30.0, 25.0, 30.0, 30.0, 27.0, 30.0, 28.0, 31.0, 28.0, 25.0, 26.0, 24.443999999999999, 34.920000000000002, 29.681999999999999, 33.0, 28.0, 34.143999999999998, 38.411999999999999, 26.0, 29.681999999999999, 26.0, 26.190000000000001, 32.398000000000003, 21.922000000000001, 27.936, 22.698, 32.398000000000003, 28.905999999999999, 36.0, 30.652000000000001, 33.173999999999999, 38.411999999999999, 24.0, 28.0, 23.0, 28.0, 34.920000000000002, 29.681999999999999, 27.936, 28.0, 26.190000000000001, 25.414000000000001, 35.0, 33.0, 34.920000000000002, 24.443999999999999, 30.652000000000001, 25.414000000000001, 25.414000000000001, 36.665999999999997, 33.173999999999999, 28.0, 29.0, 35.0, 28.0, 29.0, 33.0, 30.0, 33.0, 35.0, 33.0, 31.0, 27.0, 31.428000000000001, 33.173999999999999, 26.0, 32.0, 34.920000000000002, 33.173999999999999, 35.0, 29.0, 26.190000000000001, 27.936, 35.0, 31.0, 28.0, 34.920000000000002, 32.398000000000003, 30.0, 30.0, 27.0, 30.652000000000001, 32.0, 29.0, 27.16, 25.0, 50.634, 32.398000000000003, 38.411999999999999, 38.411999999999999, 38.0, 31.0, 35.0, 33.0, 31.0, 34.920000000000002, 33.0, 39.381999999999998, 37.0, 34.0, 32.0, 29.0, 32.0, 34.143999999999998, 28.0, 26.0, 25.0, 38.411999999999999, 29.681999999999999, 31.428000000000001, 30.652000000000001, 27.0, 27.936, 29.0, 34.920000000000002, 30.652000000000001, 33.173999999999999, 26.190000000000001, 52.0, 31.0, 26.0, 32.0, 28.0, 26.0, 27.0, 25.414000000000001, 31.428000000000001, 24.443999999999999, 26.190000000000001, 28.0, 25.0, 20.952000000000002, 27.936, 20.952000000000002, 27.16, 24.443999999999999, 32.398000000000003, 22.0, 26.0, 26.190000000000001, 29.0, 24.443999999999999, 24.443999999999999, 26.0, 26.0, 24.0, 28.0, 22.0, 27.936, 22.698, 27.936, 26.0, 24.443999999999999, 30.0, 26.190000000000001, 20.175999999999998, 21.0, 24.0, 20.0, 21.0, 21.922000000000001, 26.190000000000001, 21.922000000000001, 20.952000000000002, 26.190000000000001, 21.0, 23.0, 22.698, 25.414000000000001, 24.443999999999999, 26.0, 22.0, 27.16, 25.414000000000001, 20.952000000000002, 21.0, 23.0, 21.0, 24.0, 26.190000000000001, 17.460000000000001, 20.952000000000002, 28.0, 18.0, 19.0, 17.460000000000001, 21.922000000000001, 17.0, 18.0, 20.0, 21.922000000000001, 19.0, 20.0, 17.0, 17.460000000000001, 15.714, 17.460000000000001, 19.206, 17.460000000000001, 20.175999999999998, 22.698, 17.460000000000001, 20.175999999999998, 15.0, 21.0, 19.0, 17.0, 21.922000000000001, 19.206, 19.206, 17.460000000000001, 17.0, 17.460000000000001, 17.460000000000001, 26.190000000000001, 24.443999999999999, 22.0, 20.175999999999998, 17.0, 18.43, 19.0, 19.206, 24.0, 30.652000000000001, 27.936, 19.206, 20.175999999999998, 18.0, 20.0, 19.0, 20.952000000000002, 18.0, 22.0, 16.0, 20.0, 22.0, 26.0, 21.922000000000001, 20.0, 22.0, 20.175999999999998, 20.175999999999998, 22.698, 26.190000000000001, 20.175999999999998, 26.0, 20.952000000000002, 22.0, 21.0, 22.0, 23.667999999999999, 20.175999999999998, 19.0, 23.0, 19.206, 23.0, 22.0, 26.190000000000001, 24.0, 27.936, 26.190000000000001, 30.652000000000001, 29.0, 23.0, 25.0, 26.0, 22.0, 21.0, 25.414000000000001, 24.443999999999999, 27.0, 21.0, 24.0, 23.667999999999999, 22.0, 21.922000000000001, 36.0, 23.667999999999999, 23.0, 23.0, 28.0, 26.0, 22.698, 22.698, 26.0, 24.0, 25.0, 20.175999999999998, 24.443999999999999, 28.0, 26.0, 27.0, 28.0, 28.0, 25.0, 34.0, 33.0, 26.190000000000001, 27.0, 26.190000000000001, 35.0, 24.443999999999999, 27.0, 23.0, 31.428000000000001, 32.0, 30.0, 38.0, 36.665999999999997, 34.920000000000002, 27.16, 31.428000000000001, 28.0, 31.428000000000001, 35.0, 22.0, 24.0, 30.0, 35.890000000000001, 24.0, 30.0, 33.0, 31.428000000000001, 35.0, 27.0, 30.0, 28.0, 25.0, 30.0, 24.0, 30.652000000000001, 32.0, 33.0, 30.0, 29.0, 28.905999999999999, 28.0, 25.0, 33.0, 27.0, 26.0, 25.0, 30.0, 33.173999999999999, 29.681999999999999, 23.0, 27.936, 25.0, 28.0, 32.398000000000003, 27.0, 25.0, 33.173999999999999, 29.681999999999999, 27.936, 27.0, 26.190000000000001, 27.936, 29.681999999999999]
wind = np.array(wind) * 1.15 # to MPH

import matplotlib.pyplot as plt

(fig, ax) = plt.subplots(1,1)

ax.bar(range(1,367), wind, fc='b', ec='b')
ax.set_ylabel("Sustained Wind Speed [mph]")
ax.set_xticks( (1,32,60,91,121,152,182,213,244,274,305,335,365) )
ax.set_xticklabels( ('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec') )
ax.grid(True)
ax.set_xlim(1,367)
ax.set_title("1933-2013 Des Moines Maximum 3+ Hour Sustained Wind")
ax.set_xlabel("* Based on Hourly Observations")
fig.savefig('test.ps')
import iemplot
iemplot.makefeature('test')