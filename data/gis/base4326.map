MAP

NAME base4326
STATUS ON
SIZE 640 480
FONTSET "/mesonet/data/gis/static/fonts/fonts.list"
EXTENT -104 37 -87 49
UNITS DD
SHAPEPATH "./"
SYMBOLSET "/mesonet/data/gis/static/symbols/stations.sym"
IMAGETYPE PNG
IMAGECOLOR 0 0 255
#TRANSPARENT ON
#INTERLACE off

PROJECTION
  "init=epsg:4326"
END

WEB
  IMAGEPATH "/var/www/htdocs/tmp/"
  IMAGEURL "/tmp/"
  TEMPLATE "test.html"
END

SYMBOL
  NAME 'fill45'
  TYPE Ellipse
  FILLED TRUE
  POINTS
   1 1
  END
  STYLE 1 5 END
END


SCALEBAR
  IMAGECOLOR 255 255 255
  LABEL
    COLOR 0 0 0
    SIZE tiny
  END
  STYLE 1
  SIZE 50 10
  COLOR 0 0 0
  UNITS MILES
  INTERVALS 2
  TRANSPARENT TRUE
  STATUS TRUE
END

LEGEND
  STATUS EMBED
  #OUTLINECOLOR 0 0 0
  IMAGECOLOR 0 0 0
  LABEL
    COLOR 255 255 255
  #  SIZE 16
  #  TYPE TRUETYPE
  #  FONT 'arial'
  #  FORCE TRUE
  #  PARTIALS TRUE
  #  BUFFER 2
  END
  POSITION LR
END

LAYER
  NAME goes_east1V
  STATUS OFF
  TYPE RASTER
  DATA /home/ldm/data/gis/images/4326/goes/east1V_0.tif
  PROJECTION
    "init=epsg:4326"
  END
END

LAYER
  NAME goes_east04I4
  STATUS OFF
  TYPE RASTER
  DATA /home/ldm/data/gis/images/4326/goes/east04I4_0.tif
  PROJECTION
    "init=epsg:4326"
  END
END

LAYER
  NAME goes_west04I4
  STATUS OFF
  TYPE RASTER
  DATA /home/ldm/data/gis/images/4326/goes/west04I4_0.tif
  PROJECTION
    "init=epsg:4326"
  END
END



LAYER
  NAME goes_west1V
  STATUS OFF
  TYPE RASTER
  DATA /home/ldm/data/gis/images/4326/goes/west1V_0.tif
  PROJECTION
    "init=epsg:4326"
  END
END

# North America!!!
LAYER
  NAME namerica
  STATUS OFF
  TYPE POLYGON
  DATA /mesonet/data/gis/static/shape/4326/world/world_borders.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "FIPS_CNTRY"
  CLASS
    EXPRESSION /US/
    COLOR  105 105 105
  END
  CLASS
    COLOR 191 191 191
  END
END

# United States
LAYER
  NAME states
  STATUS OFF
  TYPE LINE
  DATA /mesonet/data/gis/static/shape/4326/us/states.shp
  METADATA
    "wms_title" "US States"
     "wms_srs" "EPSG:4326"  # Specify as Latlong?
  END
  PROJECTION
    "init=epsg:4326"
  END
  CLASS
    STYLE
      SYMBOL 'circle'
      COLOR 0 0 0
      SIZE 2
    END
  END
END

# Lakes
LAYER
  NAME lakes
  STATUS OFF
  TYPE POLYGON
  DATA /mesonet/data/gis/static/shape/4326/us/major_lakes.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    COLOR 0 0 250
  END
END

# Counties
LAYER
  NAME uscounties
  STATUS OFF
  TYPE LINE
  DATA /mesonet/data/gis/static/shape/4326/us/uscounties.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    SYMBOL "circle"
    COLOR 54 54 54
    SIZE 1
  END
END

# Counites
LAYER
  NAME uscounties_and_name
  STATUS OFF
  TYPE POLYGON
  DATA /mesonet/data/gis/static/shape/4326/us/uscounties.shp
  PROJECTION
   "init=epsg:4326"
  END
  LABELITEM "NAME"
  CLASS
    OUTLINECOLOR 255 165 0
    LABEL
      MINFEATURESIZE 50
      OUTLINECOLOR 0 0 0
      COLOR 255 255 255
      TYPE BITMAP
      SIZE MEDIUM
      POSITION CC
      PARTIALS FALSE
    END
  END
END



# Counites
LAYER
  NAME iacounties
  STATUS OFF
  TYPE LINE
  DATA /mesonet/data/gis/static/shape/4326/iowa/iacounties.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    SYMBOL "circle"
    COLOR 141 141 141
    SIZE 1
  END
END


LAYER
  NAME cwas
  STATUS OFF
  TYPE POLYGON
  DATA /mesonet/data/gis/static/shape/4326/nws/cwas.shp
  PROJECTION
   "init=epsg:4326"
  END
  LABELITEM "WFO"
  CLASS
    OUTLINECOLOR 255 165 0
    LABEL
      MINFEATURESIZE 50
      OUTLINECOLOR 0 0 0
      COLOR 255 255 255
      TYPE BITMAP
      SIZE MEDIUM
      POSITION CC
      PARTIALS FALSE
    END
  END
END

# USDM!
LAYER
  NAME usdm
  STATUS OFF
  TYPE LINE
  DATA /home/ldm/data/gis/shape/4326/us/dm_current.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "DCAT"
  CLASS
    EXPRESSION /0/
    COLOR 100 0 0
    SIZE 4
    TEXT "D0"
    SYMBOL 'circle'
    LABEL
      COLOR 255 255 255
    END
  END
  CLASS
    EXPRESSION /1/
    COLOR 120 0 0
    TEXT "D1"
    SIZE 4
    SYMBOL 'circle'
    LABEL
      COLOR 255 255 255
    END
  END
  CLASS
    EXPRESSION /2/
    COLOR 160 0 0
    TEXT "D2"
    SIZE 4
    SYMBOL 'circle'
    LABEL
      COLOR 255 255 255
    END
  END
  CLASS
    EXPRESSION /3/
    COLOR 200 0 0
    TEXT "D3"
    SYMBOL 'circle'
    SIZE 4
    LABEL
      COLOR 255 255 255
    END
  END
  CLASS
    EXPRESSION /4/
    COLOR 255 0 0
    SIZE 4
    SYMBOL 'circle'
    TEXT "D4"
    LABEL
      COLOR 255 255 255
    END
  END
END


# USDM!
LAYER
  NAME usdm_polygon
  STATUS OFF
  TYPE POLYGON
  DATA /home/ldm/data/gis/shape/4326/us/dm_current.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "DCAT"
  CLASS
    EXPRESSION /0/
    COLOR 100 0 0
  END
  CLASS
    EXPRESSION /1/
    COLOR 120 0 0
  END
  CLASS
    EXPRESSION /2/
    COLOR 160 0 0
  END
  CLASS
    EXPRESSION /3/
    COLOR 200 0 0
  END
  CLASS
    EXPRESSION /4/
    COLOR 255 0 0
  END
END


# watches
LAYER
 CONNECTIONTYPE postgis
 NAME watches
 CONNECTION "dbname=postgis host=iemdb"
 DATA "geom from watches"
 PROJECTION
  "init=epsg:4326"
 END
 TYPE LINE
 #FILTER "expired > CURRENT_TIMESTAMP"
 CLASSITEM 'wtype'
  CLASS
    EXPRESSION /SVR/
    STYLE
      COLOR 0 0 0
      SIZE 4
      SYMBOL 'circle'
    END
    STYLE
      COLOR 255 255 0
      SIZE 2
       SYMBOL 'circle'
    END
  END
  CLASS
    EXPRESSION /TOR/
    STYLE
      COLOR 0 0 0
      SIZE 4
      SYMBOL 'circle'
    END
    STYLE
      COLOR 255 0 0
      SIZE 2
      SYMBOL 'circle'
    END
  END
END

LAYER
  CONNECTIONTYPE postgis
  NAME warnings_summary
  CONNECTION "user=nobody dbname=postgis host=iemdb"
  DATA "geom from (select expire, phenomena, significance, geom, oid from warnings_summary) as foo using unique oid using SRID=4326"
  STATUS OFF
  TYPE POLYGON
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    NAME "Flash Flood Warn"
    EXPRESSION (('[phenomena]' = 'FF' or '[phenomena]' = 'MA') and '[significance]' = 'W')
    STYLE
      COLOR 0 255 0
      #SIZE 2
      #SYMBOL 1
    END
  END
  CLASS
    NAME "Svr T'storm Warn"
    EXPRESSION ('[phenomena]' = 'SV' and '[significance]' = 'W')
    STYLE
      COLOR 255 255 0
      #SIZE 2
      #SYMBOL 1
    END
  END
  CLASS
    NAME "Tornado Warn"
    EXPRESSION ('[phenomena]' = 'TO' and '[significance]' = 'W')
    STYLE
      COLOR 255 0 0
      #SIZE 2
      #SYMBOL 1
    END
  END

    # Advisories
    CLASS
        NAME "Winter Advisory"
        EXPRESSION (('[phenomena]' = 'WW' or '[phenomena]' = 'BZ'  or '[phenomena]' = 'WS' or '[phenomena]' = 'IP' or '[phenomena]' = 'HP' or '[phenomena]' = 'ZR' or '[phenomena]' = 'IS') and '[significance]' = 'Y')
        STYLE
          COLOR  222 184 135
          #SIZE  3
          #SYMBOL    'circle'
        END
        #STYLE
        #  COLOR 222 184 135
        #  SIZE  1
        #  SYMBOL    'circle'
        #END
    #TEXT ([expire])
    #LABEL
    #  COLOR 255 255 255
    #  SIZE LARGE
    #  TYPE BITMAP
    #END
    END
    # Snow and Blowing snow
    CLASS
        NAME "Sn or Blow Sn Adv"
        EXPRESSION (('[phenomena]' = 'SN' or '[phenomena]' = 'BS' or '[phenomena]' = 'SB' or '[phenomena]' = 'LE') and '[significance]' = 'Y')
        STYLE
          COLOR 176 224 230
          #SIZE  3 
          #SYMBOL    'circle'
        END
    END

    # Heavy Snow
    CLASS
        NAME "Heavy Snow Warn"
        EXPRESSION ('[phenomena]' = 'HS' and '[significance]' = 'W')
        STYLE
          COLOR 138 43 226
        END
    END
    # WW Warning
    CLASS
        NAME "Winter Storm Warn"
        EXPRESSION (('[phenomena]' = 'LE' or '[phenomena]' = 'WS' or '[phenomena]' = 'WW') and '[significance]' = 'W')
        COLOR   255 105 180
    END
    # Sleet Fz
    CLASS
        NAME "Ice/Frz/Sleet Warn"
        EXPRESSION (('[phenomena]' = 'IP' or '[phenomena]' = 'HP' or '[phenomena]' = 'ZR' or '[phenomena]' = 'IS') and '[significance]' = 'W')
        COLOR   255 20 147
    END
    # Blizzard
    CLASS
        NAME "Blizzard Warn"
        EXPRESSION ('[phenomena]' = 'BZ' and '[significance]' = 'W')
        COLOR   255 0 0
    END
    TRANSPARENCY 70
END


LAYER
  CONNECTIONTYPE postgis
  NAME warnings0_c
  CONNECTION "user=nobody dbname=postgis host=iemdb"
  DATA "geom from (select phenomena, significance, geom, oid from warnings WHERE  expire > CURRENT_TIMESTAMP and gtype = 'C') as foo using unique oid using SRID=4326"
  STATUS OFF
  TYPE LINE
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    NAME "Flash Flood Warn"
    EXPRESSION (('[phenomena]' = 'FF' or '[phenomena]' = 'MA') and '[significance]' = 'W')
    STYLE
      COLOR 0 255 0
      SIZE 2
      SYMBOL 'circle'
    END
  END
  CLASS
    NAME "Svr T'storm Warn"
    EXPRESSION ('[phenomena]' = 'SV' and '[significance]' = 'W')
    STYLE
      COLOR 0 0 0
      SIZE 4
      SYMBOL 'circle'
    END
    STYLE
      COLOR 255 255 0
      SIZE 2
      SYMBOL 'circle'
    END
  END
  CLASS
    NAME "Tornado Warn"
    EXPRESSION ('[phenomena]' = 'TO' and '[significance]' = 'W')
    STYLE
      COLOR 0 0 0
      SIZE 4
      SYMBOL 'circle'
    END
    STYLE
      COLOR 255 0 0
      SIZE 2
      SYMBOL 'circle'
    END
  END

    # Advisories
    CLASS
        NAME "Winter Advisory"
        EXPRESSION (('[phenomena]' = 'WW' or '[phenomena]' = 'BZ'  or '[phenomena]' = 'WS' or '[phenomena]' = 'IP' or '[phenomena]' = 'HP' or '[phenomena]' = 'ZR' or '[phenomena]' = 'IS') and '[significance]' = 'Y')
        STYLE
          COLOR  222 184 135
          SIZE  3
          SYMBOL    'circle'
        END
        #STYLE
        #  COLOR 222 184 135
        #  SIZE  1
        #  SYMBOL    'circle'
        #END
    END
    # Snow and Blowing snow
    CLASS
        NAME "Sn or Blow Sn Adv"
        EXPRESSION (('[phenomena]' = 'LE' or '[phenomena]' = 'SN' or '[phenomena]' = 'BS' or '[phenomena]' = 'SB') and '[significance]' = 'Y')
        STYLE
          COLOR 176 224 230
          SIZE  3 
          SYMBOL    'circle'
        END
        STYLE
          COLOR 255 255 255
          SIZE  1
          SYMBOL    'circle'
        END
    END

    # Heavy Snow
    CLASS
        NAME "Heavy Snow Warn"
        EXPRESSION ('[phenomena]' = 'HS' and '[significance]' = 'W')
        STYLE
          COLOR 138 43 226
          SIZE 3
          SYMBOL 'circle'
        END
        STYLE
          COLOR 255 255 255
          SIZE 1
          SYMBOL 'circle'
        END
    END
    # WW Warning
    CLASS
        NAME "Winter Storm Warn"
        EXPRESSION (('[phenomena]' = 'LE' or '[phenomena]' = 'WS' or '[phenomena]' = 'WW') and '[significance]' = 'W')
        COLOR   255 105 180
        SIZE    3
        SYMBOL  'circle'
    END
    # Sleet Fz
    CLASS
        NAME "Ice/Frz/Sleet Warn"
        EXPRESSION (('[phenomena]' = 'IP' or '[phenomena]' = 'HP' or '[phenomena]' = 'ZR' or '[phenomena]' = 'IS') and '[significance]' = 'W')         
        COLOR   255 20 147
        SIZE    3
        SYMBOL  'circle'
    END
    # Blizzard
    CLASS
        NAME "Blizzard Warn"
        EXPRESSION ('[phenomena]' = 'BZ' and '[significance]' = 'W')
        COLOR   255 0 0
        SIZE    3
        SYMBOL  'circle'
    END
    # Freeze Warning
    CLASS
        NAME "Freeze Warn"
        EXPRESSION ('[phenomena]' = 'FZ' and '[significance]' = 'W')
        COLOR   255 0 0
        SIZE    3
        SYMBOL  'circle'
    END
    # Marine Statement?
    CLASS
        NAME "Marine Statement"
        EXPRESSION ('[phenomena]' = 'MA' and '[significance]' = 'S')
        COLOR   0 200 0
        SIZE    3
        SYMBOL  'circle'
    END
    #CLASS
    #    NAME "Other"
    #    #EXPRESSION ('[phenomena]' = 'MA' and '[significance]' = 'S')
    #    COLOR   200 200 200
    #    SIZE    3
    #    SYMBOL  'circle'
    #END
END

LAYER
  CONNECTIONTYPE postgis
  NAME sbw
  CONNECTION "dbname=postgis host=iemdb"
  DATA "geom from (select phenomena, geom, oid from warnings WHERE significance != 'A' and expire > CURRENT_TIMESTAMP and gtype = 'P') as foo using unique oid using SRID=4326"
  STATUS OFF
  TYPE POLYGON
  METADATA
    "wms_title" "Current Polygon Warnings"
     "wms_srs" "EPSG:4269"  # Specify as Latlong?
  END
  TEMPLATE q_template.html
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM 'phenomena'
  # Tornado
  CLASS
    EXPRESSION /TO/
    STYLE
      COLOR -1 -1 -1
      OUTLINECOLOR 0 0 0
      SIZE    3
      SYMBOL  'circle'
    END
    STYLE
      COLOR -1 -1 -1
      OUTLINECOLOR 255 0 0
      SIZE    1
      SYMBOL  'circle'
    END
  END
  # SVR
  CLASS
    EXPRESSION /SV/
    STYLE
      COLOR -1 -1 -1
      OUTLINECOLOR 0 0 0
      SIZE    3
      SYMBOL  'circle'
    END
    STYLE
      COLOR -1 -1 -1
      OUTLINECOLOR 255 255 0
      SIZE    1
      SYMBOL  'circle'
    END
  END
  # MA
  CLASS
    EXPRESSION /MA/
    STYLE
      COLOR -1 -1 -1
      OUTLINECOLOR 0 0 0
      SIZE    3
      SYMBOL  'circle'
    END
    STYLE
      COLOR -1 -1 -1
      OUTLINECOLOR 0 0 255
      SIZE    1
      SYMBOL  'circle'
    END
  END
  CLASS
    EXPRESSION /ZZ/
    NAME "Storm Based Warning"
    STYLE
      COLOR -1 -1 -1 
      OUTLINECOLOR 255 255 255
      SIZE    3
      SYMBOL  'circle'
    END
    STYLE
      COLOR -1 -1 -1 
      OUTLINECOLOR 0 0 0
      SIZE    1
      SYMBOL  'circle'
    END
  END
END


LAYER
  CONNECTIONTYPE postgis
  NAME warnings0_p
  CONNECTION "dbname=postgis host=iemdb"
  #DATA "geom from warnings"
  DATA "geom from (select phenomena, geom, oid from warnings WHERE significance != 'A' and expire > CURRENT_TIMESTAMP and gtype = 'P') as foo using unique oid using SRID=4326"
  STATUS OFF
  TYPE POLYGON
  METADATA
    "wms_title" "Current Polygon Warnings"
     "wms_srs" "EPSG:4269"  # Specify as Latlong?
  END
  TEMPLATE q_template.html
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM 'phenomena'
  CLASS
    EXPRESSION /TO|SV|MA/
    COLOR -1 -1 -1
    OUTLINECOLOR 255 255 255
#    SYMBOL 1
#    SIZE 10
  END
END

INCLUDE "inc_lsrs.map"
INCLUDE "inc_spc.map"

LAYER
  NAME nexrad_n0r
  DATA /home/ldm/data/gis/images/4326/USCOMP/n0r_0.tif
  TYPE RASTER
  STATUS OFF
  METADATA
    "wms_title" "Composite NEXRAD"
  END
  PROJECTION
    "init=epsg:4326"
  END
  OFFSITE 0 0 0
  TRANSPARENCY 70
END

LAYER
  NAME nexrad_n0q
  DATA /home/ldm/data/gis/images/4326/USCOMP/n0q_0.tif
  TYPE RASTER
  STATUS OFF
  METADATA
    "wms_title" "Composite NEXRAD"
  END
  PROJECTION
    "init=epsg:4326"
  END
  OFFSITE 0 0 0
  TRANSPARENCY 70
END

#
LAYER
  TYPE POLYGON
  NAME rect
  STATUS OFF
  METADATA
    "wms_title"  "Rect Layer"
     "wms_srs"   "EPSG:26915"
  END
  PROJECTION
    "proj=latlong"
  END
  CLASS
    OUTLINECOLOR 250 250 250
  END
END

# IEM Logo
LAYER
  NAME logo
  TYPE POINT
  STATUS default
  TRANSFORM FALSE
#  TRANSPARENCY 10
  CLASS
    SYMBOL 'iem_logo'
    COLOR 0 0 0
  END
END

# Bar Header Bar!
LAYER
  NAME bar640t
  TYPE POLYGON
  TRANSFORM FALSE
  STATUS OFF
  FEATURE
    POINTS 0 0 0 36 640 36 640 0 0 0 END
  END
  TRANSPARENCY 70
  LABELCACHE FALSE
  CLASS
    COLOR 0 0 0
  END
END

# Credits
LAYER
  NAME "bar640t-title"
  TYPE ANNOTATION
  STATUS OFF
  TRANSFORM FALSE
  CLASS
    NAME 's14y'
    LABEL
      COLOR 255 255 0
      TYPE TRUETYPE
      SIZE 14
      FONT 'arial'
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
      BUFFER 2
    END
  END
  CLASS
    NAME 's12w'
    LABEL
      COLOR 255 255 255
      TYPE TRUETYPE
      SIZE 12
      FONT 'arial'
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
      BUFFER 2
    END
  END
END

# Credits
LAYER
  NAME credits
  TYPE ANNOTATION
  STATUS OFF
  TRANSFORM FALSE
  CLASS
    NAME 'credits'
    LABEL
      COLOR 0 0 0
      BACKGROUNDCOLOR 250 250 250
#      SHADOWSIZE 1 1
#      SHADOWCOLOR 0 0 0
#      BACKGROUNDSHADOWCOLOR 0 0 0
#      BACKGROUNDSHADOWSIZE 1 1
      TYPE TRUETYPE
      SIZE 16
      FONT 'altgot2n'
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
      BUFFER 2
    END
  END
  CLASS
    NAME 'credits-mono'
    LABEL
      COLOR 10 10 10
      BACKGROUNDCOLOR 245 245 245
#      SHADOWSIZE 1 1
#      SHADOWCOLOR 0 0 0
#      BACKGROUNDSHADOWCOLOR 0 0 0
#      BACKGROUNDSHADOWSIZE 1 1
      TYPE TRUETYPE
      SIZE 16
      FONT 'veramono'
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
      BUFFER 2
    END
  END
END

LAYER
  NAME "n0r-ramp"
  TYPE POINT
  STATUS default
  TRANSFORM FALSE
  TRANSPARENCY 10
  CLASS
    SYMBOL 'n0r-ramp'
    #SIZE 40
        COLOR 0 0 0
  END
END

LAYER
  NAME "n0q-ramp"
  TYPE POINT
  STATUS default
  TRANSFORM FALSE
  TRANSPARENCY 10
  CLASS
    SYMBOL 'n0q-ramp'
    #SIZE 40
        COLOR 0 0 0
  END
END

# Used in php plotter
LAYER
  NAME currents
  STATUS OFF
  TYPE POINT
  LABELCACHE ON
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    COLOR -1 -1 -1
    LABEL
      COLOR  255 255 0
      OUTLINECOLOR  0 0 0
      SHADOWCOLOR 0 0 0
      SHADOWSIZE 1 1
      SIZE 12
      MINSIZE 4
      MAXSIZE 18
      TYPE TRUETYPE
      FONT arial
      ANTIALIAS false
      BUFFER 0
      FORCE true
      POSITION UC
    END
  END
  CLASS
    COLOR -1 -1 -1
    LABEL
      COLOR  0 255 0
      OUTLINECOLOR  0 0 0
      SHADOWCOLOR 0 0 0
      SHADOWSIZE 1 1
      SIZE 12
      MINSIZE 4
      MAXSIZE 18
      TYPE TRUETYPE
      FONT arial
      ANTIALIAS false
      BUFFER 0
      FORCE true
      POSITION UC
    END
  END
END

LAYER
  NAME sname
  STATUS OFF
  TYPE POINT
  LABELCACHE ON
  PROJECTION
   "proj=latlong"
  END
  CLASS
    COLOR -1 -1 -1
    LABEL
      COLOR  255 255 255
      OUTLINECOLOR 0 0 0 
      SHADOWCOLOR 0 0 0
      SHADOWSIZE 1 2
      SIZE 10
      MINSIZE 4
      MAXSIZE 18
      TYPE TRUETYPE
      FONT arial
      ANTIALIAS true
      BUFFER 0
      FORCE true
      POSITION LC
    END
  END
END

LAYER
  TYPE POINT
  NAME pointonly
  STATUS OFF
  CLASS 
   SYMBOL 1
   COLOR 255 0 0
   SIZE 15
   LABEL
    COLOR -1 -1 -1
   END
  END
END

LAYER
  NAME barbs
  TYPE POINT
#  DATA datasets/snet_current
  STATUS OFF
  METADATA
   LYRNAME "Winds"
  END
#  LABELITEM "WIND_CHR"
#  LABELANGLEITEM "WIND_ROTAT"
  LABELCACHE ON
  PROJECTION
   "proj=latlong"
  END
  CLASS
    COLOR 255 0 0
    LABEL
        COLOR 250 0 0
        SHADOWCOLOR 0 0 0
        SHADOWSIZE 1 1
        TYPE truetype
        FONT weather
        ANTIALIAS TRUE
        SIZE 48
        POSITION UR
        OFFSET -1 -1 # for size 30 UR
        BUFFER 0
        PARTIALS TRUE
        FORCE TRUE
    END
  END
END

# Current sites
LAYER
  CONNECTIONTYPE postgis
  CONNECTION "user=nobody dbname=iem host=iemdb"
  NAME "current_sites"
  DATA "geom from (select oid as foid, geom, station, network from current 
       WHERE valid > (now() - '70 minutes'::interval) and network !~* 'COOP' ) as foo
       USING srid=4326 USING unique foid"
  STATUS OFF
  TYPE POINT
  LABELCACHE ON
  PROJECTION
    "init=epsg:4326"
  END
  CLASS
    TEXT ([station])
    COLOR 250 250 250
    SYMBOL "circle"
    SIZE 5
    LABEL
      SIZE SMALL
      OFFSET 7 0
      POSITION CR
      COLOR 0 255 0
      BACKGROUNDCOLOR -1 -1 -1
      OUTLINECOLOR 0 0 0
      TYPE BITMAP
      ANTIALIAS false
      BUFFER 3
      PARTIALS TRUE
    END
  END
END

# Current sites
LAYER
  CONNECTIONTYPE postgis
  CONNECTION "user=nobody dbname=iem host=iemdb"
  NAME "current_temps"
  DATA "geom from (select oid as foid, geom, round(tmpf::numeric,0) as tmpf from current
       WHERE valid > (now() - '70 minutes'::interval) and tmpf > -60 ) as foo
       USING srid=4326 USING unique foid"
  STATUS OFF
  TYPE POINT
  LABELCACHE OFF
  PROJECTION
    "init=epsg:4326"
  END
  CLASS
    TEXT ([tmpf])
    COLOR -1 -1 -1
    LABEL
      SIZE SMALL
      OFFSET -7 0
      POSITION CL
      COLOR 255 0 0
      BACKGROUNDCOLOR -1 -1 -1
      OUTLINECOLOR 0 0 0
      TYPE BITMAP
      ANTIALIAS false
      BUFFER 0
      PARTIALS TRUE
    END
  END
END



# Current Wind barb
LAYER
  CONNECTIONTYPE postgis
  CONNECTION "user=nobody dbname=iem host=iemdb"
  NAME "current_barbs"
  DATA "geom from (select oid as foid, geom,
    case WHEN sknt between 0 and 4.99 THEN chr(227)
       WHEN sknt between 5 and 9.99   THEN chr(228)
       WHEN sknt between 10 and 14.99 THEN chr(229)
       WHEN sknt between 15 and 19.99  THEN chr(230)
       WHEN sknt between 20  and 24.99 THEN chr(231)
       WHEN sknt between 25  and 29.99 THEN chr(232)
       WHEN sknt between 30  and 34.99 THEN chr(233)
       WHEN sknt between 35  and 39.99 THEN chr(234)
       WHEN sknt between 40  and 44.99 THEN chr(235)
       WHEN sknt between 45  and 49.99 THEN chr(236)
       ELSE '0' END as sknt,
    (0 - drct) as drct, oid from current 
       WHERE sknt >= 0 and valid > (now() - '70 minutes'::interval) ) as foo
       USING srid=4326 USING unique foid"
  STATUS OFF
  TYPE POINT
  #LABELANGLEITEM drct
  LABELCACHE OFF
  PROJECTION
    "init=epsg:4326"
  END
  CLASS
    TEXT ([sknt])
    COLOR -1 -1 -1
    LABEL
      ANGLE [drct]
      SIZE 40
      OFFSET 4 -12
      POSITION CC
      COLOR 255 255 255
      BACKGROUNDCOLOR -1 -1 -1
      OUTLINECOLOR -1 -1 -1
      TYPE TRUETYPE
      FONT weather
      ANTIALIAS false
      BUFFER 3
    END
  END
END

INCLUDE "inc_roads.map"

LAYER
  CONNECTIONTYPE postgis
  NAME surface
  # Connect to a remote spatial database
  CONNECTION "user=nobody dbname=iem host=iemdb"
  # Get the lines from the 'geom' column of the 'roads' table
  DATA "geom from (select geom, round(tsf0::numeric,0) as tsf0,
    oid from current WHERE (valid > CURRENT_TIMESTAMP - '70 minutes'::interval)
    and tsf0 > -30) as foo using unique oid using srid=4326"
  STATUS OFF
  TYPE POINT
  LABELCACHE OFF
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "tsf0"
  CLASS
    NAME ">=35"
    EXPRESSION ([tsf0] >= 35)
    COLOR 30 190 20
    SYMBOL 'circle'
    SIZE 8
  END
  CLASS
    NAME "34-35"
    EXPRESSION ([tsf0] >= 34)
    COLOR 215 255 0
    SYMBOL 'circle'
    SIZE 8
  END
  CLASS
    NAME "33-34"
    EXPRESSION ([tsf0] >= 33)
    COLOR 255 164 0
    SYMBOL 'circle'
    SIZE 8
  END
  CLASS
    NAME "32-33"
    EXPRESSION ([tsf0] >= 32)
    COLOR 255 50 0
    SYMBOL 'circle'
    SIZE 10
  END
  CLASS
    NAME "31-32"
    EXPRESSION ([tsf0] >= 31)
    COLOR 255 0 144
    SYMBOL 'circle'
    SIZE 8
  END
  CLASS
    NAME "30-31"
    EXPRESSION ([tsf0] >= 30)
    COLOR 255 0 255
    SYMBOL 'circle'
    SIZE 8
  END
  CLASS
    NAME "< 30"
    EXPRESSION ([tsf0] < 30)
    COLOR 255 255 255
    SYMBOL 'circle'
    SIZE 8
  END
END

LAYER
  CONNECTIONTYPE postgis
  NAME airtemps
  # Connect to a remote spatial database
  CONNECTION "user=nobody dbname=iem host=iemdb"
  # Get the lines from the 'geom' column of the 'roads' table
  DATA "geom from (select geom, round(tmpf::numeric,0) as tmpf, 
    oid as foid from current WHERE (valid > CURRENT_TIMESTAMP - '70 minutes'::interval)
    ) as foo using unique foid using srid=4326"
  STATUS OFF
  TYPE POINT
  LABELCACHE ON
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    EXPRESSION ([tmpf] >= 35 && [tmpf] < 120)
    TEXT ([tmpf])
    COLOR -1 -1 -1
    LABEL
      COLOR 30 190 20
      #OUTLINECOLOR 250 250 250
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 34)
    TEXT ([tmpf])
    COLOR -1 -1 -1
    LABEL
      COLOR 215 255 0
      #OUTLINECOLOR 250 250 250
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 33)
    TEXT ([tmpf])
    COLOR -1 -1 -1
    LABEL
      COLOR 255 164 0
      #OUTLINECOLOR 250 250 250
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 32)
    TEXT ([tmpf])
    COLOR -1 -1 -1
    LABEL
      COLOR 255 50 0
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 31)
    TEXT ([tmpf])
    COLOR -1 -1 -1
    LABEL
      COLOR 255 0 144
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 30)
    TEXT ([tmpf])
    COLOR -1 -1 -1
    LABEL
      #COLOR 232 164 226
      COLOR 255 0 255
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
  CLASS
    EXPRESSION ([tmpf] > -40)
    TEXT ([tmpf])
    COLOR -1 -1 -1
    LABEL
      #COLOR 232 214 226
      COLOR 255 255 255
      TYPE BITMAP
      SIZE MEDIUM
      POSITION UL
      OFFSET 2 2
      BUFFER 1
      PARTIALS TRUE
      FORCE FALSE
    END
  END
END

LAYER
  NAME interstates
  TYPE LINE
  STATUS OFF
  PROJECTION
   "init=epsg:4326"
  END
  DATA /mesonet/data/gis/static/shape/4326/us/interstates.shp
  CLASS
    COLOR 255 0 0
    SYMBOL 'circle'
    SIZE 4
    OVERLAYSYMBOL 'circle'
    OVERLAYSIZE 2
    OVERLAYCOLOR 0 0 0
  END
END


LAYER
  CONNECTIONTYPE postgis
  NAME "delta-surface15m"
  # Connect to a remote spatial database
  CONNECTION "user=nobody dbname=iem host=iemdb"
  # Get the lines from the 'geom' column of the 'roads' table
  DATA "geom from (select geom, alti_15m,
    oid from trend_15m WHERE (updated > CURRENT_TIMESTAMP - '1 hours'::interval)
    ) as foo using unique oid using srid=4326"
  STATUS OFF
  TYPE POINT
  LABELCACHE OFF
  PROJECTION
   "init=epsg:4326"
  END
        LABELITEM 'alti_15m'
        CLASS
                EXPRESSION ([alti_15m] < 0)
                LABEL
                        COLOR 250 0 0
                        OUTLINECOLOR 250 250 250
                        SIZE MEDIUM
                        TYPE BITMAP
                        FORCE TRUE
                END
        END
        CLASS
                EXPRESSION ([alti_15m] > 0)
                LABEL
                        COLOR 0 0 0
                        OUTLINECOLOR 250 250 250
                        SIZE MEDIUM
                        TYPE BITMAP
                        FORCE TRUE
                END
        END
END

LAYER
  CONNECTIONTYPE postgis
  NAME "delta-surface"
  # Connect to a remote spatial database
  CONNECTION "user=nobody dbname=iem host=iemdb"
  # Get the lines from the 'geom' column of the 'roads' table
  DATA "geom from (select geom, alti_1h,
    oid from trend_1h WHERE (updated > CURRENT_TIMESTAMP - '1 hours'::interval)
    ) as foo using unique oid using srid=4326"
  STATUS OFF
  TYPE POINT
  LABELCACHE OFF
  PROJECTION
   "init=epsg:4326"
  END
        LABELITEM 'alti_1h'
        CLASS
                EXPRESSION ([alti_1h] < 0)
                LABEL
                        COLOR 250 0 0
                        OUTLINECOLOR 250 250 250
                        SIZE MEDIUM
                        TYPE BITMAP
                        FORCE TRUE
                END
        END
        CLASS
                EXPRESSION ([alti_1h] > 0)
                LABEL
                        COLOR 0 0 0
                        OUTLINECOLOR 250 250 250
                        SIZE MEDIUM
                        TYPE BITMAP
                        FORCE TRUE
                END
        END
END

###
# Watch by County
LAYER
  CONNECTIONTYPE postgis
  NAME "watch_by_county"
  CONNECTION "dbname=postgis host=iemdb user=nobody"
  STATUS OFF
  TYPE LINE
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "phenomena"
  CLASS
    EXPRESSION 'TO'
    STYLE
      COLOR 255 0 0
      SIZE 2
      SYMBOL 'circle'
    END
  END
  CLASS
    EXPRESSION 'SV'
    STYLE
      COLOR 255 255 0
      SIZE 2
      SYMBOL 'circle'
    END
  END
END



END

