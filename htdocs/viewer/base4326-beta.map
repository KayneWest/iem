#
# Start of map file
#
NAME base4326
STATUS ON
SIZE 640 480
FONTSET "/mesonet/data/gis/fonts/fonts.list"
EXTENT -100 30 -80 45
UNITS DD
SHAPEPATH "/mesonet/data/gis/"
SYMBOLSET "/mesonet/data/gis/symbols/stations.sym"
IMAGECOLOR 0 0 250
IMAGETYPE PNG
TRANSPARENT OFF
INTERLACE off

#
PROJECTION
  "init=epsg:4326"
END

#
WEB
  TEMPLATE radar.html
  MINSCALE 90000
  MAXSCALE 40000000
  IMAGEPATH "/mesonet/www/html/tmp/"
  IMAGEURL "/tmp/"
  LOG "/tmp/warning0.log"
END

#
SCALEBAR
  IMAGECOLOR 255 255 255
  LABEL
    COLOR 0 0 0
    SIZE tiny
  END
  STYLE 1
  SIZE 50 2
  COLOR 0 0 0
  UNITS MILES
  INTERVALS 1
  TRANSPARENT TRUE
  STATUS TRUE
END

LAYER
  NAME namerica
  STATUS ON
  TYPE POLYGON
  DATA /mesonet/data/gis/shape/4326/world/world_borders.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "FIPS_CNTRY"
  CLASS
    EXPRESSION /US/
    COLOR  105 105 105
  END
  CLASS
    COLOR 191 191 191
  END
END

LAYER
  NAME lakes
  STATUS ON
  TYPE POLYGON
  DATA /mesonet/data/gis/shape/4326/us/major_lakes.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    COLOR 0 0 250
  END
END

LAYER
 NAME radar
 STATUS ON
 TYPE RASTER
 DATA "/mesonet/data/gis/images/unproj/USCOMP/n0r_0.tif"
 OFFSITE 0 0 0
 PROJECTION
  "init=epsg:4326"
 END
END

LAYER
 NAME mwradar
 STATUS ON
 TYPE RASTER
 DATA "/mesonet/data/gis/images/unproj/MWCOMP/n0r_0.tif"
 OFFSITE 0 0 0
 PROJECTION
  "init=epsg:4326"
 END
END



LAYER
  NAME counties
  STATUS ON
  TYPE POLYGON
  DATA /mesonet/data/gis/shape/4326/us/nwscounties.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    OUTLINECOLOR 54 54 54
  END
#  TRANSPARENCY 80
END

LAYER
 NAME interstates
 TYPE LINE
 STATUS OFF
 PROJECTION
  "init=epsg:4326"
 END
 DATA "shape/4326/us/interstates.shp"
 CLASS
   COLOR 204 204 204
   SYMBOL 'circle'
   SIZE 1
   #OVERLAYSYMBOL 'circle'
   #OVERLAYSIZE 1
   #OVERLAYCOLOR 0 0 0
  END
END


LAYER
  NAME states
  STATUS ON
  TYPE LINE
  LABELCACHE OFF
  DATA /mesonet/data/gis/shape/4326/us/states.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
  #  COLOR 105 105 105
    COLOR 0 0 0
    SYMBOL 'circle'
    SIZE 2
  END
#  TRANSPARENCY 80
END

LAYER
  CONNECTIONTYPE postgis
  NAME warnings0_c
  CONNECTION "user=akrherz dbname=postgis host=10.10.10.40"
  DATA "geom from (select type as wtype, geom, oid from warnings WHERE gtype = 'C' and expire > CURRENT_TIMESTAMP ORDER by expire, type ASC) as foo"
  STATUS ON
  TYPE POLYGON
  TEMPLATE q_template.html
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "wtype"
  CLASS
    EXPRESSION 'TOR'
    COLOR -1 -1 -1
    OUTLINECOLOR 255 0 0
    SIZE 2
    SYMBOL 1
  END
  CLASS
    EXPRESSION 'SVR'
    COLOR -1 -1 -1
    OUTLINECOLOR 255 255 0
    SIZE 2
    SYMBOL 1
  END
  CLASS
    EXPRESSION 'FFW'
    COLOR -1 -1 -1
    OUTLINECOLOR 0 255 0
    SIZE 2
    SYMBOL 1
  END
END

LAYER
  CONNECTIONTYPE postgis
  NAME warnings0_p
  CONNECTION "user=akrherz dbname=postgis host=10.10.10.40"
  #DATA "geom from warnings"
 DATA "geom from (select type, geom, oid from warnings WHERE gtype = 'P' and
       expire > CURRENT_TIMESTAMP  ORDER by expire, type ASC) as foo"
  STATUS ON
  TYPE POLYGON
  METADATA
    "wms_title" "Current Polygon Warnings"
     "wms_srs" "EPSG:4269"  # Specify as Latlong?
  END
  TEMPLATE q_template.html
#  FILTER "expire > CURRENT_TIMESTAMP and gtype = 'P'"
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM 'type'
  CLASS
        EXPRESSION /TOR|SVR/
    COLOR -1 -1 -1
    OUTLINECOLOR 255 255 255
    SYMBOL 1
    SIZE 1
  END
END


LAYER
 CONNECTIONTYPE postgis
 NAME watches
  CONNECTION "user=akrherz dbname=postgis host=10.10.10.40"
 DATA "geom from watches"
 PROJECTION
  "init=epsg:4326"
 END
 TYPE LINE
 STATUS DEFAULT
 FILTER "expired > CURRENT_TIMESTAMP"
 CLASSITEM 'type'
  CLASS
    EXPRESSION /SVR/
    COLOR 255 255 0
    SIZE 2
    SYMBOL 1
  END
  CLASS
    EXPRESSION /TOR/
    COLOR 255 0 0
    SIZE 2
    SYMBOL 1
  END
END

LAYER
  NAME credits
  TYPE ANNOTATION
  STATUS default
  TRANSFORM FALSE
  CLASS
    NAME 'credits'
    LABEL
      COLOR 0 0 0
      BACKGROUNDCOLOR 250 250 250
#      SHADOWSIZE 1 1
#      SHADOWCOLOR 0 0 0
#      BACKGROUNDSHADOWCOLOR 0 0 0
#      BACKGROUNDSHADOWSIZE 1 1
      TYPE TRUETYPE
      SIZE 16
      FONT 'kcci'
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
      BUFFER 2
    END
  END
END


LAYER
  NAME logo
  TYPE POINT
  STATUS default
  TRANSFORM FALSE
  TRANSPARENCY 10
  CLASS
    SYMBOL 'iem_logo'
    SIZE 40
        COLOR 0 0 0
  END
END

LAYER
  CONNECTIONTYPE postgis
  NAME sites
  # Connect to a remote spatial database
  CONNECTION "user=akrherz dbname=mesosite host=10.10.10.40"
  DATA "geom from (select geom, id, plot_name, oid, network from stations WHERE online = 't') as foo using unique oid using srid=4326"
  STATUS ON
  TYPE POINT
  LABELCACHE OFF
  PROJECTION
   "init=epsg:4326"
  END
  TOLERANCE 1000
  TOLERANCEUNITS pixels
  CLASS
    SYMBOL 'circle'
    SIZE 5
    COLOR 250 250 250
  END
END

LAYER
  CONNECTIONTYPE postgis
  NAME temps
  # Connect to a remote spatial database
  CONNECTION "user=nobody dbname=iem port=9999 host=10.10.10.30"
  # Get the lines from the 'geom' column of the 'roads' table
  DATA "geom from (select geom, round(tmpf::numeric,0) as tmpf,
    oid from current WHERE (valid > CURRENT_TIMESTAMP - '2 hours'::interval)
    ) as foo using unique oid using srid=4326"
  STATUS DEFAULT
  TYPE ANNOTATION
  LABELCACHE ON
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "tmpf"
  CLASS
    EXPRESSION ([tmpf] >= -90 && [tmpf] < 25)
    TEXT ([ tmpf ])
    LABEL
      COLOR 132 31 31
      BACKGROUNDCOLOR 250 250 250
      BACKGROUNDSHADOWCOLOR  0 0 0
      TYPE TRUETYPE
      SIZE 8
      FORCE false
      PARTIALS false
      FONT arial
      POSITION AUTO
      BUFFER 1
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 25 && [tmpf] < 33)
    TEXT ([ tmpf ])
    LABEL
      COLOR 250 250 250
      BACKGROUNDCOLOR 0 0 150
      BACKGROUNDSHADOWCOLOR  0 0 0
      TYPE TRUETYPE
      SIZE 8
      FORCE false
      PARTIALS false
      FONT arial
      POSITION AUTO
      BUFFER 1
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 33 && [tmpf] < 40)
    TEXT ([ tmpf ])
    LABEL
      COLOR 132 31 31
      BACKGROUNDCOLOR 20 250 0
      BACKGROUNDSHADOWCOLOR  0 0 0
      TYPE TRUETYPE
      SIZE 8
      FORCE false
      PARTIALS false
      FONT arial
      POSITION AUTO
      BUFFER 1
    END
  END
  CLASS
    EXPRESSION ([tmpf] >= 40 && [tmpf] < 50)
    TEXT ([ tmpf ])
    LABEL
      COLOR 132 31 31
      BACKGROUNDCOLOR 250 250 0
      BACKGROUNDSHADOWCOLOR  0 0 0
      TYPE TRUETYPE
      SIZE 8
      FORCE false
      PARTIALS false
      FONT arial
      POSITION AUTO
      BUFFER 1
    END
  END
END

END
