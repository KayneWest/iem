<?php
 include("../../config/settings.inc.php");
 $shef = isset($_GET['shef']) ? $_GET['shef'] : 0;
 $sortcol = isset($_GET['sortcol']) ? $_GET['sortcol'] : "ts";
 $network = isset($_GET['network']) ? $_GET["network"] : 'IA_DCP';
  $TITLE = "IEM | DCP Network";
   $REFRESH = "<meta http-equiv=\"refresh\" content=\"600;\">";
  $HEADEXTRA = '<script type="text/javascript" src="/js/tableruler.js"></script>
<script type="text/javascript">
    window.onload=function(){tableruler();}
</script>';
 $THISPAGE = "current-sort";
  include("$rootpath/include/header.php");
?>
<div class="text">
<a href="/DCP/">DCP Network</a> &nbsp; <b> > </b> &nbsp; Current Conditions
<?php
 include("$rootpath/include/iemaccess.php");
 include("$rootpath/include/iemaccessob.php");

 $iem = new IEMAccess();
 $ntbl = $iem->getNetwork($network);



 $db = Array();
 while (list($site, $iemob) = each($ntbl) ){
  $db[$site] = Array();
  $db[$site]['tmpf'] = "";
  $db[$site]['max_tmpf'] = "";
  $db[$site]['min_tmpf'] = "";
  if ($iemob->db["tmpf"] != -99) {
    $db[$site]['tmpf'] = $iemob->db["tmpf"];
    $db[$site]['max_tmpf'] = $iemob->db["max_tmpf"];
    $db[$site]['min_tmpf'] = $iemob->db["min_tmpf"];
  }
  $db[$site]['sname'] = $iemob->db["sname"];
  $db[$site]['phour'] = "";
  if ($iemob->db["phour"] != -99)
    $db[$site]['phour'] = $iemob->db["phour"];
  $db[$site]['ts'] = $iemob->ts;
  $db[$site]['sid'] = $site;
  $db[$site]['pday'] = "";
  if ($iemob->db["pday"] != -99)
    $db[$site]['pday'] = $iemob->db["pday"];
  $db[$site]['raw'] = $iemob->db["raw"];
   $db[$site]['rstage'] = "";
  if ($iemob->db["rstage"] > 0)
    $db[$site]['rstage'] = $iemob->db["rstage"];
 }

function aSortBySecondIndex($multiArray, $secondIndex) {
        while (list($firstIndex, ) = each($multiArray))
                $indexMap[$firstIndex] = $multiArray[$firstIndex][$secondIndex];        arsort($indexMap);
        while (list($firstIndex, ) = each($indexMap))
                if (is_numeric($firstIndex))
                        $sortedArray[] = $multiArray[$firstIndex];
                else $sortedArray[$firstIndex] = $multiArray[$firstIndex];
        return $sortedArray;
}

$db = aSortBySecondIndex($db, $sortcol);

$cols = Array("ts" => "Valid", "sid" => "Site ID", "sname" => "Station Name",
  "tmpf" => "Air Temperature", "phour" => "Rainfall One Hour", 
  "rstage" => "Stage", "pday" => "Today's Precip");
?>

<?php $current_network = "DCP"; include("$rootpath/include/current_bar.inc.php"); ?>
<form method="GET" action="current.phtml">
<input type="hidden" name="sortcol" value="<?php echo $sortcol; ?>">
Select State:<select name="network">
 <option value="AL_DCP" <?php if ($network == "AL_DCP") echo "SELECTED"; ?>>Alabama
 <option value="AK_DCP" <?php if ($network == "AK_DCP") echo "SELECTED"; ?>>Alaska
 <option value="AR_DCP" <?php if ($network == "AR_DCP") echo "SELECTED"; ?>>Arkansas
 <option value="AZ_DCP" <?php if ($network == "AZ_DCP") echo "SELECTED"; ?>>Arizona
 <option value="CA_DCP" <?php if ($network == "CA_DCP") echo "SELECTED"; ?>>California
 <option value="CO_DCP" <?php if ($network == "CO_DCP") echo "SELECTED"; ?>>Colorado
 <option value="CT_DCP" <?php if ($network == "CT_DCP") echo "SELECTED"; ?>>Connecticut
 <option value="DE_DCP" <?php if ($network == "DE_DCP") echo "SELECTED"; ?>>Delaware
 <option value="FL_DCP" <?php if ($network == "FL_DCP") echo "SELECTED"; ?>>Florida
 <option value="GA_DCP" <?php if ($network == "GA_DCP") echo "SELECTED"; ?>>Georgia
 <option value="HI_DCP" <?php if ($network == "HI_DCP") echo "SELECTED"; ?>>Hawaii
 <option value="ID_DCP" <?php if ($network == "ID_DCP") echo "SELECTED"; ?>>Idaho
 <option value="IL_DCP" <?php if ($network == "IL_DCP") echo "SELECTED"; ?>>Illinois
 <option value="IN_DCP" <?php if ($network == "IN_DCP") echo "SELECTED"; ?>>Indiana
 <option value="IA_DCP" <?php if ($network == "IA_DCP") echo "SELECTED"; ?>>Iowa
 <option value="KS_DCP" <?php if ($network == "KS_DCP") echo "SELECTED"; ?>>Kansas
 <option value="KY_DCP" <?php if ($network == "KY_DCP") echo "SELECTED"; ?>>Kentucky
 <option value="LA_DCP" <?php if ($network == "LA_DCP") echo "SELECTED"; ?>>Louisana
 <option value="ME_DCP" <?php if ($network == "ME_DCP") echo "SELECTED"; ?>>Maine
 <option value="MD_DCP" <?php if ($network == "MD_DCP") echo "SELECTED"; ?>>Maryland
 <option value="MA_DCP" <?php if ($network == "MA_DCP") echo "SELECTED"; ?>>Massachusetts
 <option value="MI_DCP" <?php if ($network == "MI_DCP") echo "SELECTED"; ?>>Michigan
 <option value="MN_DCP" <?php if ($network == "MN_DCP") echo "SELECTED"; ?>>Minnesota
 <option value="MS_DCP" <?php if ($network == "MS_DCP") echo "SELECTED"; ?>>Mississippi
 <option value="MO_DCP" <?php if ($network == "MO_DCP") echo "SELECTED"; ?>>Missouri
 <option value="MT_DCP" <?php if ($network == "MT_DCP") echo "SELECTED"; ?>>Montana
 <option value="NE_DCP" <?php if ($network == "NE_DCP") echo "SELECTED"; ?>>Nebraska
 <option value="NH_DCP" <?php if ($network == "NH_DCP") echo "SELECTED"; ?>>New Hampshire
 <option value="NC_DCP" <?php if ($network == "NC_DCP") echo "SELECTED"; ?>>North Carolina
 <option value="ND_DCP" <?php if ($network == "ND_DCP") echo "SELECTED"; ?>>North Dakota
 <option value="NV_DCP" <?php if ($network == "NV_DCP") echo "SELECTED"; ?>>Nevada
 <option value="NH_DCP" <?php if ($network == "NH_DCP") echo "SELECTED"; ?>>New Hampshire
 <option value="NJ_DCP" <?php if ($network == "NJ_DCP") echo "SELECTED"; ?>>New Jersey
 <option value="NM_DCP" <?php if ($network == "NM_DCP") echo "SELECTED"; ?>>New Mexico
 <option value="NY_DCP" <?php if ($network == "NY_DCP") echo "SELECTED"; ?>>New York
 <option value="OH_DCP" <?php if ($network == "OH_DCP") echo "SELECTED"; ?>>Ohio
 <option value="OK_DCP" <?php if ($network == "OK_DCP") echo "SELECTED"; ?>>Oklahoma
 <option value="OR_DCP" <?php if ($network == "OR_DCP") echo "SELECTED"; ?>>Oregon
 <option value="PA_DCP" <?php if ($network == "PA_DCP") echo "SELECTED"; ?>>Pennsylvania
 <option value="RI_DCP" <?php if ($network == "RI_DCP") echo "SELECTED"; ?>>Rhode Island
 <option value="SC_DCP" <?php if ($network == "SC_DCP") echo "SELECTED"; ?>>South Carolina
 <option value="SD_DCP" <?php if ($network == "SD_DCP") echo "SELECTED"; ?>>South Dakota
 <option value="TN_DCP" <?php if ($network == "TN_DCP") echo "SELECTED"; ?>>Tennessee
 <option value="TX_DCP" <?php if ($network == "TX_DCP") echo "SELECTED"; ?>>Texas
 <option value="UT_DCP" <?php if ($network == "UT_DCP") echo "SELECTED"; ?>>Utah
 <option value="VT_DCP" <?php if ($network == "VT_DCP") echo "SELECTED"; ?>>Vermont
 <option value="VA_DCP" <?php if ($network == "VA_DCP") echo "SELECTED"; ?>>Virginia
 <option value="WA_DCP" <?php if ($network == "WA_DCP") echo "SELECTED"; ?>>Washington
 <option value="WV_DCP" <?php if ($network == "WV_DCP") echo "SELECTED"; ?>>West Virginia
 <option value="WI_DCP" <?php if ($network == "WI_DCP") echo "SELECTED"; ?>>Wisconsin
 <option value="WY_DCP" <?php if ($network == "WY_DCP") echo "SELECTED"; ?>>Wyoming
</select>
<input type="submit" value="Go!">
</form>



<?php
echo "<p>Sorted by: ". $cols[$sortcol] ;
 $baseurl = "current.phtml?shef=$shef&sortcol=";
?>
<table style="width: 100%; font-size: 10pt;" cellpadding="2" border="1" cellspacing="0">
<thead>
<tr>
  <th><a href="<?php echo $baseurl; ?>sid">SiteID:</a></th>
  <th><a href="<?php echo $baseurl; ?>sname">Station Name:</a></th>
  <th><a href="<?php echo $baseurl; ?>ts">Valid:</a></th>
  <th><a href="<?php echo $baseurl; ?>rstage">Stage</a> [ft]</th>
  <th><a href="<?php echo $baseurl; ?>tmpf">Temp</a> [F]</th>
  <th><a href="<?php echo $baseurl; ?>phour">1h Rain</a> [in]</th>
  <th><a href="<?php echo $baseurl; ?>pday">Today Rain</a> [in]</th></tr></thead>
<tbody>
<?php
 $oddrow = true;
 $now = time();
 while (list($site, $value) = each($db) ){
   echo "<tr ";
   if ($oddrow) echo "bgcolor=\"#EEEEEE\"";
   echo "><td> $site </td>
    <td>". $value["sname"] ."</font></td>";
   echo "<td ";
   $tdiff = $now - $value["ts"];
   if ($tdiff > (6*3600) ){
       echo 'bgcolor="red"';
   }
   echo ">". strftime("%d %b %I:%M %p", $value["ts"]) ."</td>
    <td>". $value["rstage"] ."</td>";
   if ($value["tmpf"] != ""){
   echo "<td>". $value["tmpf"] ." (<font color=\"#ff0000\">". $value["max_tmpf"] ."</font> / <font color=\"#0000ff\">". $value["min_tmpf"] ."</font>)</td>";
   } else{
    echo "<td></td>";
   }
   echo "<td>". $value["phour"] ."</td>
    <td>". $value["pday"] ."</td>
    </tr>";
	if ($shef)
	{
		echo "<tr align=\"center\" ";
		if ($oddrow) echo "bgcolor=\"#EEEEEE\"";
		echo "><td colspan=7><font style=\"color: brown; font-size: smaller;\">". $value["raw"] ."</font></td></tr>";
	}
   $oddrow = ! $oddrow;
 }
?>
</tbody><tfoot>
<tr><td colspan=7>&nbsp;</td></tr>
</tfoot></table></div>

<?php include("$rootpath/include/footer.php");
?>
