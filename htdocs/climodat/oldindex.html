<?php
 include("/mesonet/php/lib/selectWidget.php");
 $report = isset($_GET["report"])? substr($_GET["report"],0,2): "01";
 $station = isset($_GET["station"])? strtolower( substr($_GET["station"],0,6) ): "";

 $sw = new selectWidget("index.phtml", "index.phtml?", "COOPDB" );
 $sw->setformvars( Array("report" => $report) );
 $sw->logic($_GET);

 if (isset($_GET["id"])){
   $station = $_GET["id"];
 }

 if (isset($_GET["dl"]) ){
   if (is_file("reports/${station}_${report}.txt") ){
     header("Content-type: application/octet-stream");
     header("Content-Disposition: attachment; filename=${station}_${report}.txt");
     readfile("reports/${station}_${report}.txt");
     die();
   }
 }
?>
<?php 
	$page = "current";
	$TITLE = "IEM Climodat";
	include("/mesonet/php/include/header.php"); 
?>

<h3 class="heading">IEM Climodat Interface</h3>
<?php if (strlen($station) == ""){ ?>

<div class="text">
<p><b>Disclaimer:</b> While we use care to provide accurate weather/climatic information, errors may occur because of equipment or other failure. We therefore provide this information without any warranty of accuracy. Users of this weather/climate data do so at their own risk, and are advised to use independent judgement as to whether to verify the data presented.</p>
<?php } ?>

<p><form method="GET" action="index.phtml">

<table cellpadding=2 border=1 cellspacing=0>
  <tr><th>Select Climate Station:</th><th>Select Report:</th><td></td></tr>

<tr><td><select name="station" size="1">
<?php include("../include/COOPstations.php"); 
while( list($key, $val) = each($cities) ){
  if (strlen($val["dont"]) > 0) continue;
  echo "<option value=\"$key\"";
  if ($key == $station) echo " SELECTED ";
  echo ">". $val["city"] ."\n";
}
?></select>
<br /><a href="index.phtml?report=<?php echo $report; ?>">Select Visually</a></td>

<td><select name="report" size="1">
<option value="01" <?php if ($report == "01") echo "SELECTED"; ?>>Precipitation Events per Climate Week
<option value="02" <?php if ($report == "02") echo "SELECTED"; ?>>Twelve Significant Rainfall Events
<option value="03" <?php if ($report == "03") echo "SELECTED"; ?>>Growing Degree Days
<option value="04" <?php if ($report == "04") echo "SELECTED"; ?>>Daily Record Highs and Lows
<option value="05" <?php if ($report == "05") echo "SELECTED"; ?>>Daily Maximum Precipitation
<option value="06" <?php if ($report == "06") echo "SELECTED"; ?>>Daily Record Hi and Low Ranges
<option value="07" <?php if ($report == "07") echo "SELECTED"; ?>>Daily Mean Highs and Lows
<option value="08" <?php if ($report == "08") echo "SELECTED"; ?>>Number of Days Each Year Min >= 32
<option value="09" <?php if ($report == "09") echo "SELECTED"; ?>>Last Spring/First Fall/Length of Season Base=32
<option value="10" <?php if ($report == "10") echo "SELECTED"; ?>>Last Spring/First Fall/Length of Season Base=30
<option value="11" <?php if ($report == "11") echo "SELECTED"; ?>>Last Spring/First Fall/Length of Season Base=28
<option value="12" <?php if ($report == "12") echo "SELECTED"; ?>>Last Spring/First Fall/Length of Season Base=26
<option value="13" <?php if ($report == "13") echo "SELECTED"; ?>>Last Spring/First Fall/Length of Season Base=24
<option value="14" <?php if ($report == "14") echo "SELECTED"; ?>>Monthly Average Maximum Temperatures
<option value="15" <?php if ($report == "15") echo "SELECTED"; ?>>Monthly Average Minimum Temperatures
<option value="16" <?php if ($report == "16") echo "SELECTED"; ?>>Monthly Average Mean Temperatures
<option value="17" <?php if ($report == "17") echo "SELECTED"; ?>>Monthly Precipitation Totals + Averages
<option value="18" <?php if ($report == "18") echo "SELECTED"; ?>>Monthly Heating Degree Days
<option value="19" <?php if ($report == "19") echo "SELECTED"; ?>>Monthly Cooling Degree Days
<option value="20" <?php if ($report == "20") echo "SELECTED"; ?>>Heat Stress Variables
</select></td>
<td><input type="submit" value="View Report"></td></tr></table>
</form>

<p>
<?php 
if (is_file("reports/${station}_$report.txt")){
echo "<form name=\"dl\" action=\"index.phtml\">
  <input type=\"hidden\" name=\"dl\" value=\"yes\">
  <input type=\"hidden\" name=\"station\" value=\"$station\"> 
  <input type=\"hidden\" name=\"report\" value=\"$report\">
  <input type=\"submit\" value=\"Click to Download Report\"></form>"; 

echo "<pre>\n";
  include("reports/${station}_$report.txt");
echo "</pre>\n";
} else {
?>

<p>Based on our archive of National Weather Service (NWS) Cooperative
Observer (COOP) data, we generate a set of climate reports.  These reports
are available by filling out the form above.  For the most part, these
forms are importable into spreadsheets like Excel.  

<?php echo $sw->printInterface(); ?>

<h3 class="subtitle">Archive Status:</h3>

<p>Values from 1 Jan 1951 till 1 Oct 2004 were used in the formulation of 
these reports.  Data for 2004 will continue to be updated as it is received
at the IEM.

<p>Is there a form you would like to see added?  Please let us know!

<p>Contact Info:
<br>Daryl Herzmann akrherz@iastate.edu
</div>

<?php } ?>
<?php include("/mesonet/php/include/footer.php"); ?>
