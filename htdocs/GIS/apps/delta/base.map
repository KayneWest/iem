# Defaults 
NAME iem
STATUS ON
SIZE 640 480
FONTSET "/mesonet/data/gis/static/fonts/fonts.list"
#  Iowa, yeah!
# 3x2  
#EXTENT -105 36 -86 50
EXTENT -96.7 39.35 -90 44.12
UNITS DD
SHAPEPATH "/mesonet/data/gis/"
SYMBOLSET "/mesonet/data/gis/static/symbols/stations.sym"
IMAGECOLOR 250 250 250
IMAGETYPE PNG
TRANSPARENT off
INTERLACE off

PROJECTION
  "init=epsg:4326"
END

###-----------------------
# Web section
#-----------------------
WEB
  MINSCALE 90000
  MAXSCALE 40000000
  IMAGEPATH "/var/www/htdocs/tmp/"
  IMAGEURL "/tmp/"
  LOG "/var/www/htdocs/tmp/fancy.log"
  TEMPLATE test.html
END

LAYER
  NAME states
  STATUS DEFAULT
  TYPE LINE
  DATA /mesonet/data/gis/static/shape/4326/us/states.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    SYMBOL 'circle'
    SIZE 2
#    OUTLINECOLOR 0 255 0
#    COLOR 140 144 90
    COLOR  0 0 0
  END
END

LAYER
  NAME n0r
  STATUS DEFAULT
  TYPE RASTER
  DATA /home/ldm/data/gis/images/4326/USCOMP/n0r_0.tif
  PROJECTION
   "init=epsg:4326"
  END
  OFFSITE 0 0 0 
#  TRANSPARENCY 50
END

LAYER
  NAME credits
  TYPE ANNOTATION
  STATUS default
  TRANSFORM FALSE
  CLASS
    NAME 'credits'
    LABEL
      COLOR 250 250 250
      BACKGROUNDCOLOR  0 0 0
#      SHADOWSIZE 1 1
#      SHADOWCOLOR 0 0 0
#      BACKGROUNDSHADOWCOLOR 0 0 0
#      BACKGROUNDSHADOWSIZE 1 1
      TYPE TRUETYPE
      SIZE 16
      FONT 'kcci'
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
      BUFFER 2
    END
  END
END

 
LAYER
  NAME logo
  TYPE POINT
  STATUS default
  TRANSFORM FALSE
  TRANSPARENCY 10
  CLASS
    SYMBOL 'iem_logo'
    SIZE 40
  END
END

LAYER
  NAME counties
  STATUS ON
  TYPE POLYGON
  DATA /mesonet/data/gis/static/shape/4326/us/uscounties.shp
  PROJECTION
    "init=epsg:4326"
  END
  LABELCACHE OFF
  LABELITEM 'COUNTYNAME'
  CLASS
    OUTLINECOLOR 186 116 13
#    COLOR 140 144 90
#    LABEL
#      SIZE TINY
#      TYPE BITMAP
#      POSITION LC
#      COLOR 190 190 190
#      OUTLINECOLOR 0 0 0
#      PARTIALS FALSE
#      FORCE FALSE
#    END
  END
#  TRANSPARENCY 75
END



LAYER
  CONNECTIONTYPE postgis
  NAME surface15m
  # Connect to a remote spatial database
  CONNECTION "user=nobody dbname=iem host=iemdb"
  # Get the lines from the 'geom' column of the 'roads' table
  DATA "geom from (select geom, alti_15m,
    oid from trend_15m WHERE (updated > CURRENT_TIMESTAMP - '1 hours'::interval)
    ) as foo using unique oid using srid=4326"
  STATUS ON
  TYPE POINT
  LABELCACHE OFF
  PROJECTION
   "init=epsg:4326"
  END
	LABELITEM 'alti_15m'
  	CLASS
		EXPRESSION ([alti_15m] < 0)
		LABEL
			COLOR 250 0 0
			OUTLINECOLOR 250 250 250
			SIZE MEDIUM
			TYPE BITMAP
			FORCE TRUE
		END
	END
  	CLASS
		EXPRESSION ([alti_15m] > 0)
		LABEL
			COLOR 0 0 0
			OUTLINECOLOR 250 250 250
			SIZE MEDIUM
			TYPE BITMAP
			FORCE TRUE
		END
	END
END

LAYER
  CONNECTIONTYPE postgis
  NAME surface
  # Connect to a remote spatial database
  CONNECTION "user=nobody dbname=iem host=iemdb"
  # Get the lines from the 'geom' column of the 'roads' table
  DATA "geom from (select geom, alti_1h,
    oid from trend_1h WHERE (updated > CURRENT_TIMESTAMP - '1 hours'::interval)
    ) as foo using unique oid using srid=4326"
  STATUS ON
  TYPE POINT
  LABELCACHE OFF
  PROJECTION
   "init=epsg:4326"
  END
	LABELITEM 'alti_1h'
  	CLASS
		EXPRESSION ([alti_1h] < 0)
		LABEL
			COLOR 250 0 0
			OUTLINECOLOR 250 250 250
			SIZE MEDIUM
			TYPE BITMAP
			FORCE TRUE
		END
	END
  	CLASS
		EXPRESSION ([alti_1h] > 0)
		LABEL
			COLOR 0 0 0
			OUTLINECOLOR 250 250 250
			SIZE MEDIUM
			TYPE BITMAP
			FORCE TRUE
		END
	END
END



END
