MAP
#
# Start of map file
#
NAME adjust
STATUS ON
SIZE 1024 768
#SYMBOLSET symbols/symbol.sym
FONTSET "/mesonet/data/gis/static/fonts/fonts.list"
# Good for Iowa
#EXTENT 250000 4450000 690000 4880000
#EXTENT 154000 4420187.5 766000 4879812.5
# Ames
#EXTENT 440000 4645000 450000 4660000
# Ames & Boone
#EXTENT 430000 4635000 460000 4670000
# 3x2 
#EXTENT 180000 4470000 758000 4830000
# Iowa Utm 83 Zone 14
# MW
#EXTENT 50000 4250000 890000 5080000
#EXTENT 50000 4250000 890000 5080000
#EXTENT 340000 4650000 640000 5110000
EXTENT -100 39 -94 43
##US
#EXTENT -2110437 -2251067 2548326 1239063
#UNITS METERS

# IEM Box
#EXTENT -27018.228515625 4217628 939122.4375 5111577
#UNITS METERS
#UNITS METERS
SHAPEPATH "/mesonet/data/gis/"
SYMBOLSET "../../../../data/gis/symbols/stations.sym"
#IMAGECOLOR 230 230 230
IMAGECOLOR 0 0 250
IMAGETYPE PNG
TRANSPARENT off
INTERLACE off
#EXTENT 1243813 -463393 2000000 300000
#UNITS METERS
CONFIG MS_NONSQUARE YES

# SD
#SIZE 600 400
#EXTENT 340000 4650000 640000 5110000
#    "init=epsg:26914"
#
# Projection definition, consult the PROJ.4 documentation for parameter discussion
#
PROJECTION
#  "proj=stere"
#  "lat_0=38"
#  "lon_0=-96"
#  "x_0=0"
#  "y_0=0"

  "init=epsg:4326"
#  "init=epsg:2163"
#    "init=epsg:26915"
#    "init=epsg:26914"
#   "proj=lcc"
#   "lat_1=42.0666"
#   "lat_2=43.2666"
#   "lat_0=41.5"
#   "lon_0=-94"
#   "x_0=2000000"
#   "y_0=1000000"
END

#
# Start of web interface definition
#
WEB
  HEADER q_header.html
  TEMPLATE stations.html
  FOOTER q_footer.html
  MINSCALE 90000
  MAXSCALE 46500000
  IMAGEPATH "/var/www/html/tmp/"
  IMAGEURL "/tmp/"
  LOG "/var/www/htdocs/tmp/stations.log"
END

LEGEND
  STATUS EMBED
  OUTLINECOLOR 0 0 0
  IMAGECOLOR 0 0 0
  LABEL
    COLOR 255 255 255
  END
  POSITION UL
END



SCALEBAR
  IMAGECOLOR 255 255 255
  LABEL
    COLOR 0 0 0
    SIZE tiny
  END
  STYLE 1
  SIZE 50 2
  COLOR 0 0 0
  UNITS MILES
  INTERVALS 1
  TRANSPARENT TRUE
  STATUS TRUE
END

#
#

LAYER
  NAME dm
  STATUS ON
  TYPE LINE
  DATA /home/ldm/data/gis/shape/4326/us/usdm/dm_current.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "DCAT"
  CLASS
    EXPRESSION /0/
    COLOR 100 0 0
    SIZE 4
    TEXT "D0"
    SYMBOL 'circle'
    LABEL
      COLOR 255 255 255
    END
  END
  CLASS
    EXPRESSION /1/
    COLOR 120 0 0
    TEXT "D1"
    SIZE 4
    SYMBOL 'circle'
    LABEL
      COLOR 255 255 255
    END
  END
  CLASS
    EXPRESSION /2/
    COLOR 160 0 0
    TEXT "D2"
    SIZE 4
    SYMBOL 'circle'
    LABEL
      COLOR 255 255 255
    END
  END
  CLASS
    EXPRESSION /3/
    COLOR 200 0 0
    TEXT "D3"
    SYMBOL 'circle'
    SIZE 4
    LABEL
      COLOR 255 255 255
    END
  END
  CLASS
    EXPRESSION /4/
    COLOR 255 0 0
    SIZE 4
    SYMBOL 'circle'
    TEXT "D4"
    LABEL
      COLOR 255 255 255
    END
  END
END

#
# Start of layer definitions
#

LAYER
  NAME namerica
  STATUS ON
  TYPE POLYGON
  DATA /mesonet/data/gis/static/shape/4326/world/world_borders.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "FIPS_CNTRY"
  CLASS
    EXPRESSION /US/
    COLOR  105 105 105
  END
  CLASS
    COLOR 191 191 191
  END
END

LAYER
  NAME lakes
  STATUS ON
  TYPE POLYGON
  DATA /mesonet/data/gis/static/shape/4326/us/major_lakes.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    COLOR 0 0 250
  END
END

LAYER
 CONNECTIONTYPE postgis
 NAME river
 CONNECTION "user=nobody dbname=postgis host=iemdb"
 PROJECTION
  "init=epsg:4326"
 END
 DATA "geom from (select n.geom, r.severity as s, n.nwsli from hvtec_nwsli n, riverpro r WHERE n.nwsli = r.nwsli and n.nwsli IN (select distinct hvtec_nwsli from warnings_2009 WHERE phenomena = 'FL' and status NOT IN ('EXP','CAN')) ) as foo USING unique nwsli using SRID=4326"
 TYPE POINT
 STATUS OFF
 CLASS
   NAME "Major"
   EXPRESSION ([s] = 3)
   COLOR 255 0 255
   SIZE 5
   SYMBOL "circle"
  END
 CLASS
   NAME "Moderate"
   EXPRESSION ([s] = 2)
   COLOR 255 0 0
   SIZE 5
   SYMBOL "circle"
  END
 CLASS
   NAME "Minor"
   EXPRESSION ([s] = 1)
   COLOR 255 150 0
   SIZE 5
   SYMBOL "circle"
  END
END

# Counties
LAYER
  NAME uscounties
  STATUS OFF
  TYPE LINE
  DATA /mesonet/data/gis/static/shape/4326/us/uscounties.shp
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    TEXT ([name])
    SYMBOL "circle"
    COLOR 255 255 255
    SIZE 1
  END
END


LAYER
 CONNECTIONTYPE postgis
 NAME watch_hours
  CONNECTION "user=nobody dbname=postgis host=iemdb"
 PROJECTION
  "init=epsg:4326"
 END
  DATA "geom from (select n.ugc, n.geom, extract(hours from sum(expire - issue)) as s from warnings w, nws_ugc n WHERE n.ugc = w.ugc and significance = 'W' and  phenomena IN ('BZ') and gtype = 'C' and issue between '2009-10-01' and '2010-02-02' GROUP by n.ugc, n.geom) as foo USING unique ugc using SRID=4326"
 TYPE POLYGON
 STATUS OFF
 CLASS
   NAME "30"
   EXPRESSION ([s] > 30)
   COLOR 255 0 0
  END
 CLASS
   NAME "24"
   EXPRESSION ([s] > 24)
   COLOR 255 150 0
  END
 CLASS
   NAME "16"
   EXPRESSION ([s] > 16)
   COLOR 255 255 0
  END
 CLASS
   NAME "8"
   EXPRESSION ([s] > 8)
   COLOR 0 255 0
  END
 CLASS
   NAME "1+"
   EXPRESSION ([s] > 0)
   COLOR 5 200 0
  END
END

LAYER
 CONNECTIONTYPE postgis
 NAME watches
  CONNECTION "user=nobody dbname=postgis host=iemdb"
  DATA "geom from (select type as wtype, geom, oid from watches WHERE date(expired) = '1997-04-01'  ORDER by type ASC) as foo"
 PROJECTION
  "init=epsg:4326"
 END
 TYPE POLYGON
 STATUS OFF
 CLASSITEM 'wtype'
  CLASS
    EXPRESSION /SVR/
    COLOR 255 255 0
    #SIZE 3
    #SYMBOL 1
  END
  CLASS
    EXPRESSION /TOR/
    COLOR 255 0 0
    #SIZE 3
    #SYMBOL 1
  END
END


LAYER
  CONNECTIONTYPE postgis
  NAME warnings0_c
  CONNECTION "dbname=postgis host=iemdb user=nobody"
  #DATA "geom from (select phenomena, buffer(collect(geom),0) as geom from warnings WHERE gtype = 'C' and expire > now() GROUP by phenomena) as foo USING UNIQUE phenomena using SRID=4326"
  DATA "geom from (select phenomena, type as wtype, geom, oid from warnings_2005 WHERE gtype = 'C' and significance = 'W' and phenomena = 'SV' ORDER by type ASC) as foo"
#  DATA "geom from (select expire, oid, geom, phenomena from warnings_summary) as foo USING unique oid using SRID=4326"
  STATUS ON
  TYPE LINE
  TEMPLATE q_template.html
  PROJECTION
   "init=epsg:4326"
  END
  CLASSITEM "phenomena"
  CLASS
    EXPRESSION 'TO'
    STYLE
      COLOR 255 0 0
      SIZE 2
      SYMBOL 1
    END
    #TEXT ([phenomena] [expire])
    #LABEL
    #  COLOR 255 255 255
    #  SIZE LARGE
    #  TYPE BITMAP
    #END
    #STYLE 
    #  COLOR 255 255 255
    #  #SIZE 1
    #  #SYMBOL 1
    #END
  END
  CLASS
    EXPRESSION 'SV'
    STYLE
      COLOR 255 255 0
      SIZE 2
      SYMBOL 1
    END
   # STYLE 
   #   COLOR 220 220 220
   #   #SIZE 1
   #   #SYMBOL 1
   # END
  END
  CLASS
    EXPRESSION 'FFW'
    STYLE
      COLOR 0 140 0
  #    SIZE 3
  #    SYMBOL 1
    END
  #  STYLE 
  #    COLOR 255 255 255
  #    SIZE 1
  #    SYMBOL 1
  #  END
  END
END


LAYER
  NAME counties
  STATUS OFF
  TYPE POLYGON
  DATA /mesonet/data/gis/static/shape/4326/iowa/iacounties.shp
  PROJECTION
   "proj=latlong"
  END
  CLASS
    OUTLINECOLOR 205 201 165
    #OUTLINECOLOR 0 0 0
    SIZE 1
    SYMBOL 1
    TEXT ([NAME])
    LABEL
     COLOR 255 255 255
     TYPE BITMAP
     SIZE SMALL
     POSITION CC
     PARTIALS FALSE
     FORCE TRUE
    END
  END
END

LAYER
 NAME us_n0r
 STATUS OFF
 CONNECTIONTYPE WMS
 TYPE RASTER
 CONNECTION "http://mesonet.agron.iastate.edu/cgi-bin/mapserv/mapserv.radar?map=/mesonet/www/html/GIS/apps/wms/compradar.map&amp;"
 PROJECTION
  "init=epsg:4326"
 END
 METADATA
  "wms_srs"             "EPSG:4326"
  "wms_name"            "nexrad"
  "wms_server_version"  "1.1.0"
  "wms_formatlist"      "image/png,image/jpeg,image/wbmp"
  "wms_format"          "image/png"
 END
END


LAYER
  NAME mwcounties
  STATUS OFF
  TYPE POLYGON
  DATA /mesonet/data/gis/static/shape/26915/us/counties.shp
  PROJECTION
   "init=epsg:26915"
  END
  CLASS
    #OUTLINECOLOR 205 201 165
    OUTLINECOLOR 0 0 0
    SIZE 1
    SYMBOL 1
#    TEXT ([NAME] County)
#    LABEL
#     TYPE BITMAP
#     SIZE MEDIUM
#     POSITION CC
#     PARTIALS FALSE
#    END
  END
END

LAYER
  NAME cwa
  STATUS ON
  TYPE LINE
  DATA /mesonet/data/gis/static/shape/4326/us/cwas.shp
  PROJECTION
   "proj=latlong"
  END
  TEMPLATE test.html
  #LABELITEM "CWA"
  CLASS
    COLOR 255 165 0
    SYMBOL 'circle'
    SIZE 2
   # LABEL
   #     TYPE BITMAP
   #     SIZE MEDIUM
   #     FORCE TRUE
   #     COLOR 250 250 250
   # END
  END
END


LAYER
  NAME states
  STATUS DEFAULT
  TYPE LINE
  DATA /mesonet/data/gis/static/shape/26915/us/states.shp
  PROJECTION
   "init=epsg:26915"
  END
  CLASSITEM "STATE_NAME"
  CLASS
   # EXPRESSION /Iowa/
    STYLE
      COLOR 0 255 255
      SIZE 2
      SYMBOL "circle"
    END
#    STYLE
#      COLOR 250 0 0
#      SIZE 1
#      SYMBOL "circle"
#    END
  END
  CLASS
#    OUTLINECOLOR 0 0 0

#    COLOR 0 0 0
  END
END

LAYER
  NAME iards
  TYPE LINE
  STATUS ON
  PROJECTION
   "proj=latlong"
  END
  DATA /mesonet/data/gis/static/shape/4326/us/interstates.shp
  CLASS
    SYMBOL "circle"
    COLOR 0 0 0
    SIZE 4
    OVERLAYSYMBOL "circle"
    OVERLAYCOLOR 105 105 105
    OVERLAYSIZE 2
    LABEL
      ANGLE AUTO
      TYPE TRUETYPE
      ANTIALIAS TRUE
      FONT "kcci"
      MINDISTANCE 300
      MINFEATURESIZE 10
      BUFFER 4
      SIZE 8
      POSITION AUTO
      OFFSET 0 3
      COLOR 0 0 0
      OUTLINECOLOR 255 255 204
    END
  END
END

LAYER
  NAME iards_label
  TYPE ANNOTATION
  STATUS ON
  PROJECTION
   "proj=latlong"
  END
  LABELITEM HWYNAME
  DATA /mesonet/data/gis/static/shape/4326/us/interstates.shp
  CLASS
    EXPRESSION ([HWYNAME] < 100)
    COLOR -1 -1 -1
    SYMBOL 'interstate_shield'
    LABEL
      TYPE TRUETYPE
      FONT arialblk
      POSITION CC
      MINDISTANCE 100
      MINFEATURESIZE 10
      SIZE 8
      COLOR 255 255 255
      PARTIALS FALSE
    END
  END
END

LAYER
  NAME roads
  STATUS ON
  TYPE LINE
#  MAXSCALE 1000000
#  TILEINDEX "/mesonet/data/gis/shape/26915/iowa/iaroads/iaroads"
  DATA "/mesonet/data/gis/static/shape/26915/iowa/iaroads.shp"
#  CLASSITEM "SYSCODE"
  CLASS
#    EXPRESSION /1/
    SYMBOL "circle"
    COLOR 0 0 0
    SIZE 3
    OVERLAYSYMBOL "circle"
    OVERLAYCOLOR 250 250 250
    OVERLAYSIZE 1
    LABEL
      ANGLE AUTO
      TYPE TRUETYPE
      ANTIALIAS TRUE
      FONT "kcci"
      MINDISTANCE 300
      MINFEATURESIZE 10
      BUFFER 4
      SIZE 8
     POSITION AUTO
      OFFSET 0 3
      COLOR 0 0 0
      OUTLINECOLOR 255 255 204
    END
  END
  CLASS
#    EXPRESSION /2|3/
    SYMBOL "circle"
    COLOR 0 0 0
    SIZE 3
    OVERLAYSYMBOL "circle"
    OVERLAYCOLOR 255 255 255
    OVERLAYSIZE 1
    LABEL
      ANGLE AUTO
      TYPE TRUETYPE
      ANTIALIAS TRUE
      FONT "kcci"
      MINDISTANCE 300
      MINFEATURESIZE 10
      BUFFER 4
      SIZE 8
      POSITION AUTO
      OFFSET 0 3
      COLOR 0 0 0
      OUTLINECOLOR 255 255 204
    END
  END
END

LAYER
  NAME cities
  TYPE POINT
  PROJECTION
   "proj=latlong"
  END
  DATA /mesonet/data/gis/static/shape/4326/iowa/iacities.shp
  LABELITEM 'Name'
  CLASS
    OUTLINECOLOR 255 255 0
    SIZE 4
    SYMBOL 1
    LABEL
     COLOR 255 255 0
      OUTLINECOLOR -1 -1 -1
      TYPE TRUETYPE
      FONT 'kcci'
      SIZE 16
      POSITION UL
      PARTIALS FALSE 
    END
  END
END

LAYER
  CONNECTIONTYPE postgis
  NAME sites
  CONNECTION "host=iemdb user=nobody dbname=iem"
  DATA "geom from (select station, oid, round(CASE WHEN max_gust > max_sknt THEN max_gust else max_sknt END::numeric * 1.15,0) as val, geom from summary_2010 WHERE network in ('IA_ASOS','AWOS') and day = '2010-01-25' and (max_gust > 0 or max_sknt > 0)) as foo using unique oid using srid=4326"
  #FILTER "network = 'IA_RWIS'"
  STATUS ON
  TYPE POINT
  LABELCACHE ON
#  LABELMAXSCALE 600000
#  MINSCALE 600000
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    #SYMBOL 'triangle'
    COLOR 0 0 0
    #SIZE 5
    TEXT ([val])
    LABEL
     COLOR 250 250 0 
      OUTLINECOLOR 0 0 0
      TYPE TRUETYPE
      FONT 'vera'
      ANTIALIAS TRUE
      SIZE 12
      POSITION AUTO
      PARTIALS TRUE
      FORCE FALSE
      BUFFER 1
      WRAP "_"
    END
  END
END


LAYER
  CONNECTIONTYPE postgis
  NAME locs
  CONNECTION "host=iemdb user=nobody dbname=iem"
  DATA "geom from (select oid, geom,  round(max_tmpf::numeric,0) as mint from summary WHERE network IN ('IA_ASOS','AWOS') and day = '2009-04-06' and min_tmpf < 50) as foo using unique oid using srid=4326"
  #DATA "geom from (select oid, geom, snowd as mint from summary WHERE network IN ('IA_COOP') and day = '2009-04-06' and snowd >= 0) as foo using unique oid using srid=4326"
#  FILTER "state = 'IA'"
#  FILTER "network = 'IA_RWIS'"
  STATUS ON
  TYPE POINT
#  LABELMAXSCALE 600000
#  MINSCALE 600000
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    TEXT ([mint])
    SYMBOL 'circle'
    SIZE 3
    COLOR 255 255 255
    LABEL
      OUTLINECOLOR 0 0 0
      COLOR 255 255 255
      TYPE BITMAP
      SIZE MEDIUM
      POSITION AUTO
      PARTIALS FALSE
    END
  END
END

LAYER
  NAME terra
  DATA "dusty.jpg"
  TYPE RASTER
  STATUS OFF
  PROJECTION
   "init=epsg:4326"
  END
END

LAYER
  NAME maxdbz
  DATA "max_n0r_0z0z_20090809.png"
  TYPE RASTER
  STATUS OFF
  PROJECTION
   "init=epsg:4326"
  END
END


LAYER
  NAME topo
  DATA /mesonet/data/gis/images/stereo/ustopo4_stere.tif
  TYPE RASTER
  STATUS ON
  OFFSITE 0 0 0
  PROJECTION
     "proj=stere"
  "lat_0=38"
  "lon_0=-96"
  "x_0=0"
  "y_0=0"

  END
END


LAYER
  NAME isabel
  DATA /mesonet/data/gis/images/unproj/ISABEL/n0r_0.tif
  TYPE RASTER
  STATUS ON
  OFFSITE 0 0 0
  PROJECTION
   "proj=latlong"
  END
END

LAYER
  NAME credits
  TYPE ANNOTATION
  STATUS default
  TRANSFORM FALSE
  LABELCACHE OFF
  CLASS
    LABEL
      WRAP "_"
      OUTLINECOLOR 255 255 0
      COLOR 0 0 0
   #   SHADOWSIZE 1 1
   #   SHADOWCOLOR 0 0 0
   #   BACKGROUNDSHADOWCOLOR 0 0 0
   #   BACKGROUNDSHADOWSIZE 1 1
      TYPE TRUETYPE
      SIZE 12
      FONT 'arial'
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
      ANTIALIAS TRUE
    END
  END
END

LAYER
  NAME iembox
  TYPE LINE
  STATUS OFF
  FEATURE
    POINTS -97.632 39.651 -97.632 44.319 -89.317 44.319 -89.317 39.651 -97.632 39.651 END
  END
  PROJECTION
   "init=epsg:4326"
  END
  CLASS
    STYLE
      COLOR 255 0 0
      SIZE 3
      SYMBOL 'circle'
    END
    STYLE
      COLOR 255 255 255
      SIZE 1
      SYMBOL 'circle'
    END
  END
END

LAYER
  NAME bars
  TYPE POLYGON
  TRANSFORM FALSE
  STATUS ON
  FEATURE
    POINTS 0 0 0 20 640 20 640 0 0 0 END
  END
  TRANSPARENCY 70
  LABELCACHE FALSE
  CLASS
    COLOR 0 0 0
  END
END


LAYER 
  NAME logo
  TYPE POINT
  STATUS default
  TRANSFORM FALSE
  CLASS
    SYMBOL 'iem_logo'
    COLOR 0 0 0
  END
END
END
