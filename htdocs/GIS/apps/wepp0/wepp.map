# 9 May 2003	The only! .map file for the WEPP project....
#
#
NAME wepp
STATUS ON
SIZE 640 480
#SYMBOLSET symbols/symbol.sym
FONTSET "/mesonet/data/gis/fonts/fonts.list"
# Iowa
#EXTENT 200000 4400000 710000 4900000
# 3x2  600x400
EXTENT 160000 4450000 760000 4850000
# Washington County
#EXTENT 567973 4537344 647029 4616582
UNITS METERS
SHAPEPATH "/mesonet/data/gis/"
SYMBOLSET "/mesonet/data/gis/symbols/stations.sym"
IMAGECOLOR 255 255 255
IMAGETYPE PNG
TRANSPARENT off
INTERLACE off

#
# Projection definition, consult the PROJ.4 documentation for parameter discussion
#
PROJECTION
  "init=epsg:26915"
END

#
# Start of web interface definition
#
WEB
  HEADER q_header.html
  TEMPLATE fancy.html
  FOOTER q_footer.html
  MINSCALE 90000
  MAXSCALE 40000000
  IMAGEPATH "/var/www/htdocs/tmp/"
  IMAGEURL "/tmp/"
  LOG "/var/www/htdocs/tmp/fancy.log"
END



SCALEBAR
  IMAGECOLOR 255 255 255
  LABEL
    COLOR 0 0 0
    SIZE tiny
  END
  STYLE 1
  SIZE 50 2
  COLOR 0 0 0
  UNITS MILES
  INTERVALS 1
  TRANSPARENT TRUE
  STATUS TRUE
END

LAYER
  NAME background
  DATA /mesonet/data/gis/images/26915/iatopo2.png
  TYPE RASTER
  PROJECTION
   "init=epsg:26915"
  END
  STATUS ON
END

LAYER
  NAME counties
  STATUS DEFAULT
  TYPE POLYGON
  DATA /mesonet/data/gis/shape/26915/iowa/iacounties.shp
  PROJECTION
   "init=epsg:26915"
  END
  CLASS
    OUTLINECOLOR 205 201 165
    COLOR -1 -1 -1
  END
END

LAYER
  NAME states
  STATUS DEFAULT
  TYPE POLYGON
  DATA /mesonet/data/gis/shape/26915/usa/states.shp
  PROJECTION
   "init=epsg:26915"
  END
  CLASS
   EXPRESSION ([STATE_FIPS] != 19)
   OUTLINECOLOR 0 0 0
   COLOR 255 255 255
  END
END

LAYER
  NAME rainfall
  STATUS ON
  TYPE POINT
  DATA /home/wepp/GIS/raindata/20030505.shp
  PROJECTION
   "proj=latlong"
  END
#  TRANSPARENCY 90
END

LAYER
  CONNECTIONTYPE postgis
  NAME iatwp
  CONNECTION "user=akrherz dbname=wepp host=mesonet-db1.agron.iastate.edu"
  DATA "the_geom from (select oid, the_geom, random() * 200 as runoff from iatwp) as foo using unique oid using srid=26915"
#  DATA "the_geom from (select t.oid, t.the_geom, t.model_twp as mtwp, r.runoff from results r, combos c, iatwp t WHERE r.valid = '2002-07-09' and r.run_id = c.id and c.model_twp = t.model_twp) as foo"
  STATUS ON
  TYPE POLYGON
  TEMPLATE q_template.html
#  CLASSITEM 'model_twp'
#  FILTER " model_twp in ('T74NR06W', 'T74NR07W', 'T74NR08W', 'T74NR09W', 'T75NR06W', 'T75NR07W', 'T75NR08W', 'T75NR09W', 'T76NR06W', 'T76NR07W', 'T76NR08W', 'T77NR08W', 'T77NR09W') "

  PROJECTION
    "proj=utm"
    "ellps=GRS80"
    "zone=15"
    "north"
    "no_defs"
  END
  CLASS
    OUTLINECOLOR 0 0 255
  END
#  CLASS
#    EXPRESSION ([runoff] < 10)
#    COLOR 135 206 235  # Sky Blue
#  END
#  CLASS
#    EXPRESSION ([runoff] < 20) 
#    COLOR 123 104 238 # Medium Slate Blue
#  END
#  CLASS
#    EXPRESSION ([runoff] < 50) 
#    COLOR 0 0 255 # Blue
#  END
#  CLASS
#    EXPRESSION ([runoff] < 90) 
#    COLOR 233 150 122 # dark salmon
#  END
#  CLASS
#    EXPRESSION ([runoff] < 120) 
#    COLOR 210 105 30 # Chocolate
#  END
#  CLASS
#    EXPRESSION ([runoff] < 200) 
#    COLOR 255 0 0 # Big Red
#  END
END

LAYER
  CONNECTIONTYPE postgis
  NAME ppoints
  CONNECTION "user=akrherz dbname=wepp host=mesonet-db1.agron.iastate.edu"
  DATA "geom from precip_points"
  FILTER " iowa = 'T'"
  STATUS ON
  TYPE POINT
PROJECTION
  "proj=latlong"
END
  CLASS
    COLOR 0 0 255
    BACKGROUNDCOLOR -1 -1 -1
    SYMBOL 1
    SIZE 3
  END
END

LAYER
  CONNECTIONTYPE postgis
  NAME temp
  CONNECTION "user=akrherz dbname=wepp host=mesonet-db1.agron.iastate.edu"
  DATA "the_geom from temp"
  STATUS ON
  TYPE POINT
  PROJECTION
    "proj=utm"
    "ellps=GRS80"
    "zone=15"
    "north"
    "no_defs"
  END
  CLASSITEM 'model_twp'
  CLASS
    EXPRESSION 'T86NR29W'
    COLOR 0 0 255
    BACKGROUNDCOLOR -1 -1 -1
    SYMBOL 1
    SIZE 1
  END
END

LAYER
  CONNECTIONTYPE postgis
  NAME erosion
  CONNECTION "user=akrherz dbname=wepp host=10.10.10.20"
#  DATA "the_geom from (select t.oid as oid, max(r.runoff) as runoff, t.the_geom as the_geom from results r, combos c, iatwp t WHERE r.valid = '2003-04-30' and r.run_id = c.id and c.model_twp = t.model_twp GROUP by t.the_geom, t.oid) as foo using unique oid using srid=26915"
  DATA "the_geom from (select t.oid as oid, r.avg_precip as val, t.the_geom as the_geom from results_by_twp r LEFT OUTER JOIN iatwp t on (t.model_twp = r.model_twp) WHERE r.valid = '2003-05-04') as foo using unique oid using srid=26915"
  STATUS DEFAULT
  TYPE POLYGON
  PROJECTION
    "init=epsg:26915"
#    "proj=utm"
#    "ellps=GRS80"
#    "zone=15"
#    "north"
#    "no_defs"
  END
  TRANSPARENCY 90
END

LAYER 
  NAME clrbar
  TYPE POINT
  STATUS default
  TRANSFORM FALSE
  TRANSPARENCY 10
  CLASS
    SYMBOL 'clrbar'
    SIZE 1
  END
END

LAYER
  NAME credits
  TYPE ANNOTATION
  STATUS default
  TRANSFORM FALSE
  LABELCACHE OFF
  CLASS
    NAME 'credits'
    LABEL
      COLOR 0 0 255
      BACKGROUNDCOLOR 0 0 200
      SHADOWSIZE 1 1
      SHADOWCOLOR 0 0 0
      BACKGROUNDSHADOWCOLOR 0 0 0
      BACKGROUNDSHADOWSIZE 1 1
      TYPE TRUETYPE
      SIZE 16
      FONT 'arial'
      POSITION CR
      FORCE TRUE
      PARTIALS TRUE
    END
  END
END

LAYER
  NAME singlebox
  TYPE POLYGON
  STATUS DEFAULT
  TRANSFORM FALSE
  LABELCACHE OFF
  TRANSPARENCY 80
  CLASS
    COLOR 0 0 0
    OUTLINECOLOR 0 0 0
    LABEL
      COLOR 0 0 0
      TYPE BITMAP
      SIZE LARGE
      POSITION LR
      OFFSET 15 5
    END
  END
END

LAYER
  NAME wmsback
  STATUS ON
  CONNECTIONTYPE WMS
  TYPE RASTER
#  CONNECTION "http://komodo.gis.iastate.edu/server.cgi/14906.jpg?format=png&wmtver=1.0.0&request=map&servicename=iowa&layers=relief&"
  CONNECTION "http://cairo.gis.iastate.edu/cgi-bin/server.cgi/88.jpg?format=png&wmtver=1.0.0&request=map&servicename=GetMap&layers=doqqs"
  PROJECTION
    "init=epsg:26915"
  END
END

LAYER
  TYPE POLYGON
  NAME rect
  STATUS ON
  PROJECTION
    "init=epsg:26915"
  END
  CLASS
    COLOR -1 -1 -1
    OUTLINECOLOR 255 255 255   
    LABEL
      COLOR  255 255 255
      OUTLINECOLOR 0 0 0 
      SHADOWCOLOR 0 0 0
      SHADOWSIZE 1 2
      SIZE 8
      MINSIZE 4
      MAXSIZE 18
      TYPE TRUETYPE
      FONT arialblk
      ANTIALIAS false
      BUFFER 0
      FORCE true
      POSITION LL
    END
  END
END

LAYER
  NAME iards
  TYPE LINE
  STATUS ON
  PROJECTION
   "proj=latlong"
  END
  DATA /mesonet/data/gis/shape/unproj/iowa/interstates.shp
  CLASS
    SYMBOL "circle"
    COLOR 0 0 0
    SIZE 4
    OVERLAYSYMBOL "circle"
    OVERLAYCOLOR 105 105 105
    OVERLAYSIZE 2
    LABEL
      ANGLE AUTO
      TYPE TRUETYPE
      ANTIALIAS TRUE
      FONT "kcci"
      MINDISTANCE 300
      MINFEATURESIZE 10
      BUFFER 4
      SIZE 8
      POSITION AUTO
      OFFSET 0 3
      COLOR 0 0 0
      OUTLINECOLOR 255 255 204
    END
  END
END

LAYER
  NAME iards_label
  TYPE ANNOTATION
  STATUS ON
  PROJECTION
   "proj=latlong"
  END
  LABELITEM HWYNAME
  DATA /mesonet/data/gis/shape/unproj/iowa/interstates.shp
  CLASS
    EXPRESSION ([HWYNAME] < 100)
    COLOR -1 -1 -1
    SYMBOL 'interstate_shield'
    LABEL
      TYPE TRUETYPE
      FONT arialblk
      POSITION CC
      MINDISTANCE 100
      MINFEATURESIZE 10
      SIZE 8
      COLOR 255 255 255
      PARTIALS FALSE
    END
  END
END

END
